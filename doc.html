<!DOCTYPE html>

<html lang="en" data-content_root="./">
  <head>
    <meta charset="utf-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" /><meta name="viewport" content="width=device-width, initial-scale=1" />

    <title>Appendix B: Cpu0 document and test &#8212; Tutorial: Creating an LLVM Backend for the Cpu0 Architecture</title>
    <link rel="stylesheet" type="text/css" href="_static/pygments.css?v=03e43079" />
    <link rel="stylesheet" type="text/css" href="_static/haiku.css?v=fce32b03" />
    <link rel="stylesheet" type="text/css" href="_static/graphviz.css?v=4ae1632d" />
    <script src="_static/documentation_options.js?v=e33d5c4b"></script>
    <script src="_static/doctools.js?v=fd6eb6e6"></script>
    <script src="_static/sphinx_highlight.js?v=6ffebe34"></script>
    <script defer="defer" src="https://cdn.jsdelivr.net/npm/mathjax@4/tex-mml-chtml.js"></script>
    <link rel="author" title="About these documents" href="about.html" />
    <link rel="index" title="Index" href="genindex.html" />
    <link rel="search" title="Search" href="search.html" />
    <link rel="next" title="Appendix C: The concept of NPU (Neural Processor Unit) compiler" href="npu.html" />
    <link rel="prev" title="Appendix A: Getting Started: Installing LLVM and the Cpu0 Example Code" href="install.html" /> 
  </head><body>
      <div class="header" role="banner"><h1 class="heading"><a href="index.html">
          <span>Tutorial: Creating an LLVM Backend for the Cpu0 Architecture</span></a></h1>
        <h2 class="heading"><span>Appendix B: Cpu0 document and test</span></h2>
      </div>
      <div class="topnav" role="navigation" aria-label="Top">
      
        <p>
        «&#160;&#160;<a href="install.html">Appendix A: Getting Started: Installing LLVM and the Cpu0 Example Code</a>
        &#160;&#160;::&#160;&#160;
        <a class="uplink" href="index.html">Contents</a>
        &#160;&#160;::&#160;&#160;
        <a href="npu.html">Appendix C: The concept of NPU (Neural Processor Unit) compiler</a>&#160;&#160;»
        </p>

      </div>
      <div class="content" role="main">
        
        
  <section id="appendix-b-cpu0-document-and-test">
<span id="sec-appendix-doc"></span><h1>Appendix B: Cpu0 document and test<a class="headerlink" href="#appendix-b-cpu0-document-and-test" title="Link to this heading">¶</a></h1>
<nav class="contents local" id="contents">
<ul class="simple">
<li><p><a class="reference internal" href="#github" id="id16">github</a></p>
<ul>
<li><p><a class="reference internal" href="#create-gh-pages" id="id17">Create gh-pages</a></p></li>
</ul>
</li>
<li><p><a class="reference internal" href="#rest-format" id="id18">reST format</a></p>
<ul>
<li><p><a class="reference internal" href="#six-levels-of-chapter-section-subsections" id="id19">Six Levels of Chapter, section, subsections</a></p></li>
<li><p><a class="reference internal" href="#symbols" id="id20">Symbols</a></p></li>
<li><p><a class="reference internal" href="#math" id="id21">Math</a></p></li>
<li><p><a class="reference internal" href="#figures" id="id22">Figures</a></p></li>
<li><p><a class="reference internal" href="#graphviz" id="id23">Graphviz</a></p></li>
</ul>
</li>
<li><p><a class="reference internal" href="#cpu0-document" id="id24">Cpu0 document</a></p>
<ul>
<li><p><a class="reference internal" href="#install-sphinx" id="id25">Install sphinx</a></p></li>
<li><p><a class="reference internal" href="#note-of-sphinx" id="id26">Note of Sphinx</a></p></li>
<li><p><a class="reference internal" href="#generate-cpu0-document" id="id27">Generate Cpu0 document</a></p></li>
<li><p><a class="reference internal" href="#about-cpu0-document" id="id28">About Cpu0 Document</a></p></li>
</ul>
</li>
<li><p><a class="reference internal" href="#cpu0-regression-test" id="id29">Cpu0 Regression Test</a></p></li>
</ul>
</nav>
<section id="github">
<h2><a class="toc-backref" href="#id16" role="doc-backlink">github</a><a class="headerlink" href="#github" title="Link to this heading">¶</a></h2>
<section id="create-gh-pages">
<h3><a class="toc-backref" href="#id17" role="doc-backlink">Create gh-pages</a><a class="headerlink" href="#create-gh-pages" title="Link to this heading">¶</a></h3>
<ol class="arabic simple">
<li><p>Create a new orphan branch for GitHub Pages and clean the directory.</p></li>
</ol>
<div class="highlight-console notranslate"><div class="highlight"><pre><span></span><span class="gp">% </span>git<span class="w"> </span>branch
<span class="go">* gh-pages</span>
<span class="go">master</span>

<span class="gp">% </span>git<span class="w"> </span>checkout<span class="w"> </span>--orphan<span class="w"> </span>gh-pages
<span class="gp">% </span>git<span class="w"> </span>rm<span class="w"> </span>-rf<span class="w"> </span>.
</pre></div>
</div>
<ol class="arabic simple" start="2">
<li><p>GitHub Pages build error</p></li>
</ol>
<blockquote>
<div><ul class="simple">
<li><p>Cause: GitHub tries to build Jekyll by default</p></li>
<li><p>Fix: Add a .nojekyll file to the root of gh-pages:</p></li>
</ul>
</div></blockquote>
<div class="highlight-console notranslate"><div class="highlight"><pre><span></span><span class="gp">% </span>git<span class="w"> </span>branch
<span class="go">* gh-pages</span>
<span class="go">master</span>

<span class="gp">% </span>touch<span class="w"> </span>.nojekyll
<span class="gp">% </span>git<span class="w"> </span>add<span class="w"> </span>.nojekyll
<span class="gp">% </span>git<span class="w"> </span>commit<span class="w"> </span>-m<span class="w"> </span><span class="s2">&quot;Disable Jekyll&quot;</span>
<span class="gp">% </span>git<span class="w"> </span>push
</pre></div>
</div>
</section>
</section>
<section id="rest-format">
<h2><a class="toc-backref" href="#id18" role="doc-backlink">reST format</a><a class="headerlink" href="#rest-format" title="Link to this heading">¶</a></h2>
<p>The reSTructure format (Sphinx).</p>
<section id="six-levels-of-chapter-section-subsections">
<h3><a class="toc-backref" href="#id19" role="doc-backlink">Six Levels of Chapter, section, subsections</a><a class="headerlink" href="#six-levels-of-chapter-section-subsections" title="Link to this heading">¶</a></h3>
<p class="rubric">Six Levels of Chapter, section, subsections</p>
<div class="highlight-console notranslate"><div class="highlight"><pre><span></span><span class="go">1. Chapter -- Level 1</span>
<span class="go">===============</span>
<span class="go">Level 1 Title</span>
<span class="go">===============</span>

<span class="go">2. Section -- Level 2</span>
<span class="go">---------------</span>
<span class="go">Level 2 Title</span>
<span class="go">---------------</span>

<span class="go">3. Subsection -- Level3</span>
<span class="go">***************</span>
<span class="go">Level 3 Title</span>
<span class="go">***************</span>

<span class="go">4. Subsection -- Level4</span>
<span class="go">^^^^^^^^^^^^^^^</span>
<span class="go">Level 4 Title</span>
<span class="go">^^^^^^^^^^^^^^^</span>

<span class="go">5. Subsection -- Level5</span>
<span class="go">&quot;&quot;&quot;&quot;&quot;&quot;&quot;&quot;&quot;&quot;&quot;&quot;&quot;&quot;&quot;</span>
<span class="go">Level 5 Title</span>
<span class="go">&quot;&quot;&quot;&quot;&quot;&quot;&quot;&quot;&quot;&quot;&quot;&quot;&quot;&quot;&quot;</span>

<span class="go">6. Subsection -- Level6</span>
<span class="go">~~~~~~~~~~~~~~~</span>
<span class="go">Level 6 Title</span>
<span class="go">~~~~~~~~~~~~~~~</span>
</pre></div>
</div>
<ul class="simple">
<li><p>Do not use more than 90 characters per line in <code class="docutils literal notranslate"><span class="pre">code-block::</span> <span class="pre">console</span></code> or any
other code block, otherwise errors may occur during <cite>make latexpdf</cite>.</p></li>
<li><p>Use <code class="docutils literal notranslate"><span class="pre">\clearpage</span></code> (see gpu.rst) to force page breaks in pdf and avoid content
splitting across two pages.</p></li>
<li><p>For instructions on inserting a reference before any paragraph that is not a
section heading, see the word <code class="docutils literal notranslate"><span class="pre">cfg-warps</span></code> in gpu.rst.</p></li>
</ul>
</section>
<section id="symbols">
<h3><a class="toc-backref" href="#id20" role="doc-backlink">Symbols</a><a class="headerlink" href="#symbols" title="Link to this heading">¶</a></h3>
<p>Pdf (xelatex) recognizes:</p>
<ol class="arabic simple">
<li><p>Basic geometric shapes</p></li>
</ol>
<ul class="simple">
<li><p>●  (black circle)</p></li>
<li><p>○  (white circle)</p></li>
<li><p>■  (black square)</p></li>
<li><p>□  (white square)</p></li>
<li><p>◆  (black diamond)</p></li>
<li><p>◇  (white diamond)</p></li>
<li><p>►  (black right pointer)</p></li>
<li><p>◄  (black left pointer)</p></li>
<li><p>▲  (black up triangle)</p></li>
<li><p>▼  (black down triangle)</p></li>
</ul>
<ol class="arabic simple" start="2">
<li><p>Classic dingbats</p></li>
</ol>
<ul class="simple">
<li><p>✓  (check mark)</p></li>
<li><p>✗  (ballot X)</p></li>
<li><p>✦  (four-point star)</p></li>
<li><p>✧  (open four-point star)</p></li>
<li><p>✱  (heavy asterisk)</p></li>
<li><p>✲  (open center asterisk)</p></li>
<li><p>✳  (eight-spoked asterisk)</p></li>
</ul>
<ol class="arabic simple" start="3">
<li><p>Miscellaneous symbols</p></li>
</ol>
<ul class="simple">
<li><p>⚠️  (warning sign)</p></li>
<li><p>⚡  (high voltage)</p></li>
<li><p>★ / ☆  ✨  ↦ ⇢ ➚ / ➘ ↺ / ↻ ∴ → ∵ ⟳ ⤴ ⇧  ✦→ ⧖ ✦ ✧</p></li>
<li><p>⚓  (anchor)</p></li>
<li><p>⚙️  (gear)</p></li>
<li><p>⚖️  (scales)</p></li>
<li><p>⚒  (hammer and pick)</p></li>
<li><p>⚔️  (crossed swords)</p></li>
<li><p>⚕️  (medical symbol)</p></li>
<li><p>⚘  (flower)</p></li>
<li><p>⚪  (white circle)</p></li>
<li><p>⚫  (black circle)</p></li>
</ul>
<ol class="arabic simple" start="4">
<li><p>Arrows</p></li>
</ol>
<ul class="simple">
<li><p>← → ↑ ↓</p></li>
<li><p>↔ ↕</p></li>
<li><p>↦ ↤</p></li>
<li><p>⇐ ⇒ ⇑ ⇓</p></li>
<li><p>⇔</p></li>
<li><p>Use math: <code class="docutils literal notranslate"><span class="pre">:math:`\Leftarrow`</span></code> or <code class="docutils literal notranslate"><span class="pre">:math:`\Rightarrow`</span></code>;  <span class="math notranslate nohighlight">\(\Leftarrow\)</span> <span class="math notranslate nohighlight">\(\Rightarrow\)</span>; reference <a class="reference internal" href="gpu.html#cross-product"><span class="std std-ref">Cross Product</span></a>.</p></li>
</ul>
<div class="math notranslate nohighlight">
\[\Leftarrow,   \Rightarrow\]</div>
</section>
<section id="math">
<h3><a class="toc-backref" href="#id21" role="doc-backlink">Math</a><a class="headerlink" href="#math" title="Link to this heading">¶</a></h3>
<ul class="simple">
<li><p>Sphinx supports math symbols; see references <a class="footnote-reference brackets" href="#sphinx-math" id="id1" role="doc-noteref"><span class="fn-bracket">[</span>4<span class="fn-bracket">]</span></a> and
<a class="footnote-reference brackets" href="#mathbase-latex" id="id2" role="doc-noteref"><span class="fn-bracket">[</span>5<span class="fn-bracket">]</span></a> for more details.</p></li>
</ul>
</section>
<section id="figures">
<h3><a class="toc-backref" href="#id22" role="doc-backlink">Figures</a><a class="headerlink" href="#figures" title="Link to this heading">¶</a></h3>
<ul class="simple">
<li><p>Figures side by side: refer to <code class="docutils literal notranslate"><span class="pre">sm:left</span></code> in gpu.rst.</p></li>
</ul>
</section>
<section id="graphviz">
<h3><a class="toc-backref" href="#id23" role="doc-backlink">Graphviz</a><a class="headerlink" href="#graphviz" title="Link to this heading">¶</a></h3>
<ul class="simple">
<li><p>To draw nodes inside a parent node, use “compound=true;” and subgraph
cluster_name <a class="footnote-reference brackets" href="#graphviz-cluster" id="id3" role="doc-noteref"><span class="fn-bracket">[</span>7<span class="fn-bracket">]</span></a>. To create edges from/to parent nodes,
use the attributes “ltail” and “lhead” set to the parent node.</p></li>
<li><p>See graphviz documents here <a class="footnote-reference brackets" href="#gv-doc-pdf" id="id4" role="doc-noteref"><span class="fn-bracket">[</span>6<span class="fn-bracket">]</span></a>.</p></li>
</ul>
</section>
</section>
<section id="cpu0-document">
<h2><a class="toc-backref" href="#id24" role="doc-backlink">Cpu0 document</a><a class="headerlink" href="#cpu0-document" title="Link to this heading">¶</a></h2>
<p>This section illustrates how to generate Cpu0 backend document.</p>
<section id="install-sphinx">
<h3><a class="toc-backref" href="#id25" role="doc-backlink">Install sphinx</a><a class="headerlink" href="#install-sphinx" title="Link to this heading">¶</a></h3>
<p>LLVM and this book use Sphinx to generate HTML documents. This book uses
Sphinx to generate PDF and EPUB formats as well. See the installation guide
here <a class="footnote-reference brackets" href="#sphinx-install" id="id5" role="doc-noteref"><span class="fn-bracket">[</span>1<span class="fn-bracket">]</span></a>.</p>
<p>Sphinx uses reStructuredText format; see <a class="footnote-reference brackets" href="#rst-ref" id="id6" role="doc-noteref"><span class="fn-bracket">[</span>8<span class="fn-bracket">]</span></a>, <a class="footnote-reference brackets" href="#rst-dir" id="id7" role="doc-noteref"><span class="fn-bracket">[</span>9<span class="fn-bracket">]</span></a>, and <a class="footnote-reference brackets" href="#rst" id="id8" role="doc-noteref"><span class="fn-bracket">[</span>10<span class="fn-bracket">]</span></a>.
For code-block formatting in this document, see <a class="footnote-reference brackets" href="#llvm-sphinx-quick" id="id9" role="doc-noteref"><span class="fn-bracket">[</span>11<span class="fn-bracket">]</span></a> and
<a class="footnote-reference brackets" href="#sphinx-lexers" id="id10" role="doc-noteref"><span class="fn-bracket">[</span>12<span class="fn-bracket">]</span></a>.</p>
<p>On iMac you can install as follows:</p>
<div class="highlight-console notranslate"><div class="highlight"><pre><span></span><span class="go">brew install sphinx-doc</span>
<span class="go">echo &#39;export PATH=&quot;/opt/homebrew/opt/sphinx-doc/bin:$PATH&quot;&#39; &gt;&gt; ~/.zshrc</span>
<span class="gp">% </span><span class="nb">source</span><span class="w"> </span>~/.zshrc
</pre></div>
</div>
<p>On Linux, install with:</p>
<div class="highlight-console notranslate"><div class="highlight"><pre><span></span><span class="go">sudo apt-get install python3-sphinx</span>
</pre></div>
</div>
<p>The above installs Sphinx for making HTML documents but not PDF.</p>
<p>For PDF/LaTeX generation, install the following.</p>
<p>On iMac, install MacTeX.pkg from here <a class="footnote-reference brackets" href="#maxtex" id="id11" role="doc-noteref"><span class="fn-bracket">[</span>2<span class="fn-bracket">]</span></a> and restart your computer.</p>
<p>On Linux, install texlive as follows:</p>
<div class="highlight-console notranslate"><div class="highlight"><pre><span></span><span class="go">sudo apt-get install texlive texlive-latex-extra latexmk</span>
</pre></div>
</div>
<p>or</p>
<div class="highlight-console notranslate"><div class="highlight"><pre><span></span><span class="go">sudo yum install texlive texlive-latex-extra latexmk</span>
</pre></div>
</div>
<p>On Fedora 17, the texlive-latex-extra package is missing. Instead, install
the package that includes pdflatex. For example, install pdfjam on Fedora 17
as follows,</p>
<div class="highlight-console notranslate"><div class="highlight"><pre><span></span><span class="gp">[root@localhost lbd]$ </span>yum<span class="w"> </span>list<span class="w"> </span>pdfjam
<span class="go">Loaded plugins: langpacks, presto, refresh-packagekit</span>
<span class="go">Installed Packages</span>
<span class="go">pdfjam.noarch                        2.08-3.fc17                         @fedora</span>
<span class="gp">[root@localhost lbd]$</span>
</pre></div>
</div>
<p>Do</p>
<div class="highlight-console notranslate"><div class="highlight"><pre><span></span><span class="go">sudo apt-get update -y</span>
<span class="go">sudo apt-get install -y latexmk</span>
</pre></div>
</div>
<p>if latexmk gives error during ‘make latexpdf’ <a class="footnote-reference brackets" href="#latexmk" id="id12" role="doc-noteref"><span class="fn-bracket">[</span>3<span class="fn-bracket">]</span></a>.</p>
<p>After upgrading to iMac OS X 10.11.1, the pdflatex link may be missing. Fix it by
adding the following to your <code class="docutils literal notranslate"><span class="pre">.profile</span></code>:</p>
<div class="highlight-console notranslate"><div class="highlight"><pre><span></span><span class="gp">114-37-153-62:lbd Jonathan$ </span>ls<span class="w"> </span>/usr/local/texlive/2012/bin/universal-darwin/pdflatex
<span class="go">/usr/local/texlive/2012/bin/universal-darwin/pdflatex</span>
<span class="gp">114-37-153-62:lbd Jonathan$ </span>cat<span class="w"> </span>~/.profile
<span class="go">export PATH=$PATH:...:/usr/local/texlive/2012/bin/universal-darwin</span>
</pre></div>
</div>
</section>
<section id="note-of-sphinx">
<h3><a class="toc-backref" href="#id26" role="doc-backlink">Note of Sphinx</a><a class="headerlink" href="#note-of-sphinx" title="Link to this heading">¶</a></h3>
<div class="highlight-console notranslate"><div class="highlight"><pre><span></span><span class="gp">$</span>HOME/git/lbd$<span class="w"> </span>make<span class="w"> </span>latexpdf

<span class="go">Latexmk: applying rule &#39;pdflatex&#39;...</span>
<span class="go">Rule &#39;pdflatex&#39;: File changes, etc:</span>
<span class="go">   Changed files, or newly in use since previous run(s):</span>
<span class="go">  LLVMToolchainCpu0.aux</span>
<span class="go">  LLVMToolchainCpu0.toc</span>
<span class="go">Rule &#39;pdflatex&#39;: The following rules &amp; subrules became out-of-date:</span>
<span class="go">  pdflatex</span>
<span class="go">Latexmk: Maximum runs of pdflatex reached without getting stable files</span>
<span class="go">Latexmk: All targets (LLVMToolchainCpu0.pdf) are up-to-date</span>
<span class="go">----------------------</span>
<span class="go">This message may duplicate earlier message.</span>
<span class="go">Latexmk: Failure in processing file &#39;LLVMToolchainCpu0.tex&#39;:</span>
<span class="go">   &#39;pdflatex&#39; needed too many passes</span>
<span class="go">----------------------</span>
<span class="go">Latexmk: If appropriate, the -f option can be used to get latexmk</span>
<span class="go">  to try to force complete processing.</span>
<span class="go">make[1]: *** [LLVMToolchainCpu0.pdf] Error 12</span>
<span class="go">make: *** [latexpdf] Error 2</span>
<span class="go">make latexpdf  14.57s user 1.11s system 99% cpu 15.790 total</span>
</pre></div>
</div>
</section>
<section id="generate-cpu0-document">
<h3><a class="toc-backref" href="#id27" role="doc-backlink">Generate Cpu0 document</a><a class="headerlink" href="#generate-cpu0-document" title="Link to this heading">¶</a></h3>
<p>The Cpu0 example code is added chapter by chapter.
It can be configured to a specific chapter by changing the CH definition in
Cpu0SetChapter.h.
For example, the following definition configures it to chapter 2.</p>
<p class="rubric">lbdex/Cpu0/Cpu0SetChapter.h</p>
<div class="highlight-c++ notranslate"><div class="highlight"><pre><span></span><span class="cp">#define CH       CH2</span>
</pre></div>
</div>
<p>To help readers understand the backend structure step by step, the Cpu0 example
code can be generated chapter by chapter using the following commands:</p>
<div class="highlight-console notranslate"><div class="highlight"><pre><span></span><span class="gp">118-165-12-177:lbd Jonathan$ </span><span class="nb">pwd</span>
<span class="go">/home/Jonathan/test/lbd</span>
<span class="gp">118-165-12-177:lbd Jonathan$ </span>make<span class="w"> </span>genexample
<span class="go">...</span>
<span class="gp">118-165-12-177:lbd Jonathan$ </span>ls<span class="w"> </span>lbdex/chapters/
<span class="go">Chapter10_1  Chapter2    Chapter3_4  Chapter5_1  Chapter8_2</span>
<span class="go">Chapter11_1  Chapter3_1  Chapter3_5  Chapter6_1  Chapter9_1</span>
<span class="go">Chapter11_2  Chapter3_2  Chapter4_1  Chapter7_1  Chapter9_2</span>
<span class="go">Chapter12_1  Chapter3_3  Chapter4_2  Chapter8_1  Chapter9_3</span>
</pre></div>
</div>
<p>Besides the example code in each chapter, the above HTML and PDF Cpu0 documents
also include the *.ll and *.s files located in the lbd/lbdex/output directory.</p>
<div class="highlight-console notranslate"><div class="highlight"><pre><span></span><span class="gp">JonathantekiiMac:lbd Jonathan$ </span>ls<span class="w"> </span>lbdex/output/
<span class="go">ch12_eh.cpu0.s                        ch12_thread_var.cpu0.pic.s      ch12_thread_var.ll</span>
<span class="go">ch12_eh.ll                    ch12_thread_var.cpu0.static.s   ch4_math.s</span>
</pre></div>
</div>
<p>Then, the HTML and PDF versions of this book can be generated by running the
following commands.</p>
<div class="highlight-console notranslate"><div class="highlight"><pre><span></span><span class="gp">118-165-12-177:lbd Jonathan$ </span><span class="nb">pwd</span>
<span class="go">/home/Jonathan/test/lbd</span>
<span class="gp">118-165-12-177:lbd Jonathan$ </span>make<span class="w"> </span>html
<span class="go">...</span>
<span class="gp">118-165-12-177:lbd Jonathan$ </span>make<span class="w"> </span>latexpdf
<span class="go">...</span>
</pre></div>
</div>
</section>
<section id="about-cpu0-document">
<h3><a class="toc-backref" href="#id28" role="doc-backlink">About Cpu0 Document</a><a class="headerlink" href="#about-cpu0-document" title="Link to this heading">¶</a></h3>
<p>Since LLVM has a new release about every 6 months, and names of files,
functions, classes, variables, etc. may change, maintaining the Cpu0 document
is a continuous effort. The document adds code chapter by chapter.</p>
<p>To keep the document correct and easy to maintain, I use the <code class="docutils literal notranslate"><span class="pre">:start-after:</span></code>
and <code class="docutils literal notranslate"><span class="pre">:end-before:</span></code> directives of reStructuredText to keep the document up to
date.</p>
<p>For every new release, when the Cpu0 backend code changes, the document will
reflect those changes in most of its content.</p>
<p>In the <code class="docutils literal notranslate"><span class="pre">lbdex/Cpu0</span></code> folder, text beginning with <code class="docutils literal notranslate"><span class="pre">//\&#64;</span></code> and <code class="docutils literal notranslate"><span class="pre">#ifdef</span> <span class="pre">CH</span> <span class="pre">&gt;</span> <span class="pre">CHxx</span></code>
is referenced by document files <code class="docutils literal notranslate"><span class="pre">*.rst</span></code>.</p>
<p>In <code class="docutils literal notranslate"><span class="pre">lbdex/llvm/modify/llvm</span></code>, the <code class="docutils literal notranslate"><span class="pre">*.rst</span></code> files reference the code by copying
it directly. Most references exist in <code class="docutils literal notranslate"><span class="pre">llvmstructure.rst</span></code> and <code class="docutils literal notranslate"><span class="pre">elf.rst</span></code>.</p>
<p>The example C/C++ code in <code class="docutils literal notranslate"><span class="pre">lbdex/input</span></code> comes from my own ideas and refers to
the <code class="docutils literal notranslate"><span class="pre">clang/test/CodeGen</span></code> directory in the Clang source code release.</p>
</section>
</section>
<section id="cpu0-regression-test">
<h2><a class="toc-backref" href="#id29" role="doc-backlink">Cpu0 Regression Test</a><a class="headerlink" href="#cpu0-regression-test" title="Link to this heading">¶</a></h2>
<p>The last chapter can verify the Cpu0 backend’s generated code by using a Verilog
simulator for code without global variable access.</p>
<p>The chapter <em>lld</em> in the repository <a class="reference external" href="https://github.com/Jonathan2251/lbt.git">https://github.com/Jonathan2251/lbt.git</a> includes
an LLVM ELF linker implementation and can verify test items involving global variable access.</p>
<p>However, LLVM provides its own test cases (regression tests) for each backend to verify
the backend compiler <a class="footnote-reference brackets" href="#test" id="id13" role="doc-noteref"><span class="fn-bracket">[</span>13<span class="fn-bracket">]</span></a> without needing a simulator or real hardware platform.</p>
<p>Cpu0 regression test items exist in the lbdex.tar.gz example code. Untar it into the
lbdex/ directory.</p>
<p>For both iMac and Linux, copy the folder:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">lbdex</span><span class="o">/</span><span class="n">regression</span><span class="o">-</span><span class="n">test</span><span class="o">/</span><span class="n">Cpu0</span>
</pre></div>
</div>
<p>To</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="o">~/</span><span class="n">llvm</span><span class="o">/</span><span class="n">test</span><span class="o">/</span><span class="n">llvm</span><span class="o">/</span><span class="n">test</span><span class="o">/</span><span class="n">CodeGen</span><span class="o">/</span><span class="n">Cpu0</span>
</pre></div>
</div>
<p>Then run the tests as follows on iMac, for both single and all test cases:</p>
<div class="highlight-console notranslate"><div class="highlight"><pre><span></span><span class="gp">$ </span>llvm-lit<span class="w"> </span>-a<span class="w"> </span>~/llvm/test/llvm/test/CodeGen/Cpu0
</pre></div>
</div>
<p>The option <strong>-a</strong> shows the executing commands for each test case.</p>
<div class="highlight-console notranslate"><div class="highlight"><pre><span></span><span class="gp">1-160-130-77:Cpu0 Jonathan$ </span><span class="nb">pwd</span>
<span class="go">/Users/Jonathan/llvm/test/llvm/test/CodeGen/Cpu0</span>
<span class="gp">1-160-130-77:Cpu0 Jonathan$ </span>~/llvm/test/build/bin/llvm-lit<span class="w"> </span>seteq.ll
<span class="go">-- Testing: 1 tests, 1 threads --</span>
<span class="go">PASS: LLVM :: CodeGen/Cpu0/seteq.ll (1 of 1)</span>
<span class="go">Testing Time: 0.08s</span>
<span class="go">  Expected Passes    : 1</span>
<span class="gp">1-160-130-77:Cpu0 Jonathan$ </span>~/llvm/test/build/bin/llvm-lit<span class="w"> </span>.
<span class="go">...</span>
<span class="go">PASS: LLVM :: CodeGen/Cpu0/zeroreg.ll</span>
<span class="go">PASS: LLVM :: CodeGen/Cpu0/tailcall.ll</span>
<span class="go">...</span>
</pre></div>
</div>
<p>Run the following command to execute the test on Linux.</p>
<div class="highlight-console notranslate"><div class="highlight"><pre><span></span><span class="gp">$ </span><span class="nb">pwd</span>
<span class="go">/home/cschen/llvm/test/llvm/test/CodeGen/Cpu0</span>
<span class="gp">$ </span>~/llvm/test/build/bin/llvm-lit<span class="w"> </span>seteq.ll
<span class="go">-- Testing: 1 tests, 1 threads --</span>
<span class="go">PASS: LLVM :: CodeGen/Cpu0/seteq.ll (1 of 1)</span>
<span class="go">Testing Time: 0.08s</span>
<span class="go">  Expected Passes    : 1</span>
<span class="gp">$ </span>~/llvm/test/build/bin/llvm-lit<span class="w"> </span>.
<span class="go">...</span>
<span class="go">PASS: LLVM :: CodeGen/Cpu0/zeroreg.ll</span>
<span class="go">PASS: LLVM :: CodeGen/Cpu0/tailcall.ll</span>
<span class="go">...</span>
</pre></div>
</div>
<p>The chapters of this book and their related regression test items are listed
as follows:</p>
<table class="docutils align-default" id="id14">
<caption><span class="caption-number">Table 65 </span><span class="caption-text">Chapters</span><a class="headerlink" href="#id14" title="Link to this table">¶</a></caption>
<tbody>
<tr class="row-odd"><td><p>1</p></td>
<td><p>about</p></td>
</tr>
<tr class="row-even"><td><p>2</p></td>
<td><p>Cpu0 architecture and LLVM structure</p></td>
</tr>
<tr class="row-odd"><td><p>3</p></td>
<td><p>Backend structure</p></td>
</tr>
<tr class="row-even"><td><p>4</p></td>
<td><p>Arithmetic and logic instructions</p></td>
</tr>
<tr class="row-odd"><td><p>5</p></td>
<td><p>Generating object files</p></td>
</tr>
<tr class="row-even"><td><p>6</p></td>
<td><p>Global variables</p></td>
</tr>
<tr class="row-odd"><td><p>7</p></td>
<td><p>Other data type</p></td>
</tr>
<tr class="row-even"><td><p>8</p></td>
<td><p>Control flow statements</p></td>
</tr>
<tr class="row-odd"><td><p>9</p></td>
<td><p>Function call</p></td>
</tr>
<tr class="row-even"><td><p>10</p></td>
<td><p>ELF Support</p></td>
</tr>
<tr class="row-odd"><td><p>11</p></td>
<td><p>Assembler</p></td>
</tr>
<tr class="row-even"><td><p>12</p></td>
<td><p>C++ support</p></td>
</tr>
<tr class="row-odd"><td><p>13</p></td>
<td><p>Verify backend on verilog simulator</p></td>
</tr>
</tbody>
</table>
<table class="docutils align-default" id="id15">
<caption><span class="caption-number">Table 66 </span><span class="caption-text">Regression test items for Cpu0</span><a class="headerlink" href="#id15" title="Link to this table">¶</a></caption>
<thead>
<tr class="row-odd"><th class="head"><p>File</p></th>
<th class="head"><p>v:pass x:fail</p></th>
<th class="head"><p>test ir, -&gt; output asm</p></th>
<th class="head"><p>chapter</p></th>
</tr>
</thead>
<tbody>
<tr class="row-even"><td><p>2008-06-05-Carry.ll</p></td>
<td><p>v</p></td>
<td></td>
<td><p>7</p></td>
</tr>
<tr class="row-odd"><td><p>2008-07-15-InternalConstant.ll</p></td>
<td><p>v</p></td>
<td></td>
<td><p>6</p></td>
</tr>
<tr class="row-even"><td><p>2008-07-15-SmallSection.ll</p></td>
<td><p>v</p></td>
<td></td>
<td><p>6</p></td>
</tr>
<tr class="row-odd"><td><p>2008-07-03-SRet.ll</p></td>
<td><p>v</p></td>
<td></td>
<td><p>9</p></td>
</tr>
<tr class="row-even"><td><p>2008-07-29-icmp.ll</p></td>
<td><p>v</p></td>
<td></td>
<td><p>8</p></td>
</tr>
<tr class="row-odd"><td><p>2008-08-06-Alloca.ll</p></td>
<td><p>v</p></td>
<td></td>
<td><p>9</p></td>
</tr>
<tr class="row-even"><td><p>2008-08-01-AsmInline.ll</p></td>
<td><p>v</p></td>
<td></td>
<td><p>11</p></td>
</tr>
<tr class="row-odd"><td><p>2008-08-08-ctlz.ll</p></td>
<td><p>v</p></td>
<td></td>
<td><p>7</p></td>
</tr>
<tr class="row-even"><td><p>2008-08-08-bswap.ll</p></td>
<td><p>v</p></td>
<td><p>bswap</p></td>
<td><p>12</p></td>
</tr>
<tr class="row-odd"><td><p>2008-10-13-LegalizerBug.ll</p></td>
<td><p>v</p></td>
<td></td>
<td><p>8</p></td>
</tr>
<tr class="row-even"><td><p>2010-11-09-Mul.ll</p></td>
<td><p>v</p></td>
<td></td>
<td><p>4</p></td>
</tr>
<tr class="row-odd"><td><p>2010-11-09-CountLeading.ll</p></td>
<td><p>v</p></td>
<td></td>
<td><p>7</p></td>
</tr>
<tr class="row-even"><td><p>2008-11-10-xint_to_fp.ll</p></td>
<td><p>v</p></td>
<td></td>
<td><p>7</p></td>
</tr>
<tr class="row-odd"><td><p>addc.ll</p></td>
<td><p>v</p></td>
<td><p>64-bit add</p></td>
<td><p>7</p></td>
</tr>
<tr class="row-even"><td><p>addi.ll</p></td>
<td><p>v</p></td>
<td><p>32-bit add, sub</p></td>
<td><p>4</p></td>
</tr>
<tr class="row-odd"><td><p>address-mode.ll</p></td>
<td><p>v</p></td>
<td><p>br, -&gt; BB0_2:</p></td>
<td><p>8</p></td>
</tr>
<tr class="row-even"><td><p>alloca.ll</p></td>
<td><p>v</p></td>
<td><p>alloca i8, i32 %size, dynamic allocation</p></td>
<td><p>9</p></td>
</tr>
<tr class="row-odd"><td><p>analyzebranch.ll</p></td>
<td><p>v</p></td>
<td><p>br, -&gt; bne, beq</p></td>
<td><p>8</p></td>
</tr>
<tr class="row-even"><td><p>and1.ll</p></td>
<td><p>v</p></td>
<td><p>and</p></td>
<td><p>4</p></td>
</tr>
<tr class="row-odd"><td><p>asm-large-immediate.ll</p></td>
<td><p>v</p></td>
<td><p>inline asm</p></td>
<td><p>11</p></td>
</tr>
<tr class="row-even"><td><p>atomic-1.ll</p></td>
<td><p>v</p></td>
<td><p>atomic</p></td>
<td><p>12</p></td>
</tr>
<tr class="row-odd"><td><p>atomic-2.ll</p></td>
<td><p>v</p></td>
<td><p>atomic</p></td>
<td><p>12</p></td>
</tr>
<tr class="row-even"><td><p>atomics.ll</p></td>
<td><p>v</p></td>
<td><p>atomic</p></td>
<td><p>12</p></td>
</tr>
<tr class="row-odd"><td><p>atomics-index.ll</p></td>
<td><p>v</p></td>
<td><p>atomic</p></td>
<td><p>12</p></td>
</tr>
<tr class="row-even"><td><p>atomics-fence.ll</p></td>
<td><p>v</p></td>
<td><p>atomic</p></td>
<td><p>12</p></td>
</tr>
<tr class="row-odd"><td><p>br-jmp.ll</p></td>
<td><p>v</p></td>
<td><p>br, -&gt; jmp</p></td>
<td><p>8</p></td>
</tr>
<tr class="row-even"><td><p>brockaddress.ll</p></td>
<td><p>v</p></td>
<td><p>blockaddress, -&gt; lui, ori</p></td>
<td><p>8</p></td>
</tr>
<tr class="row-odd"><td><p>cmov.ll</p></td>
<td><p>v</p></td>
<td><p>select, -&gt; movn, movz</p></td>
<td><p>8</p></td>
</tr>
<tr class="row-even"><td><p>cprestore.ll</p></td>
<td><p>v</p></td>
<td><p>-&gt; .cprestore</p></td>
<td><p>9</p></td>
</tr>
<tr class="row-odd"><td><p>div.ll</p></td>
<td><p>v</p></td>
<td><p>sdiv, -&gt; div, mflo</p></td>
<td><p>4</p></td>
</tr>
<tr class="row-even"><td><p>divrem.ll</p></td>
<td><p>v</p></td>
<td><p>sdiv, srem, udiv, urem, -&gt; div, divu</p></td>
<td><p>4</p></td>
</tr>
<tr class="row-odd"><td><p>div_rem.ll</p></td>
<td><p>v</p></td>
<td><p>sdiv, srem, -&gt; div, mflo, mfhi</p></td>
<td><p>4</p></td>
</tr>
<tr class="row-even"><td><p>divu.ll</p></td>
<td><p>v</p></td>
<td><p>udiv, -&gt; divu, mflo</p></td>
<td><p>4</p></td>
</tr>
<tr class="row-odd"><td><p>divu_reml.ll</p></td>
<td><p>v</p></td>
<td><p>udiv, urem -&gt; div, mflo, mfhi</p></td>
<td><p>4</p></td>
</tr>
<tr class="row-even"><td><p>double2int.ll</p></td>
<td><p>v</p></td>
<td><p>double to int, -&gt; %call16(__fixdfsi)</p></td>
<td><p>7</p></td>
</tr>
<tr class="row-odd"><td><p>eh-dwraf-cfa.ll</p></td>
<td><p>v</p></td>
<td></td>
<td><p>9</p></td>
</tr>
<tr class="row-even"><td><p>eh-return32.ll</p></td>
<td><p>v</p></td>
<td><p>Spill and reload all registers used for exception</p></td>
<td><p>9</p></td>
</tr>
<tr class="row-odd"><td><p>eh.ll</p></td>
<td><p>v</p></td>
<td><p>c++ exception handling</p></td>
<td><p>12</p></td>
</tr>
<tr class="row-even"><td><p>ex2.ll</p></td>
<td><p>v</p></td>
<td><p>c++ exception handling</p></td>
<td><p>12</p></td>
</tr>
<tr class="row-odd"><td><p>fastcc.ll</p></td>
<td><p>v</p></td>
<td><p>No effect in fastcc but can pass</p></td>
<td><p>9</p></td>
</tr>
<tr class="row-even"><td><p>fneg.ll</p></td>
<td><p>v</p></td>
<td><p>verify Cpu0 don’t uses hard float instruction</p></td>
<td><p>7</p></td>
</tr>
<tr class="row-odd"><td><p>fp-spill-reload.ll</p></td>
<td><p>v</p></td>
<td><p>-&gt; st $fp, ld $fp</p></td>
<td><p>9</p></td>
</tr>
<tr class="row-even"><td><p>frame-address.ll</p></td>
<td><p>v</p></td>
<td><p>addu $2, $zero, $fp</p></td>
<td><p>9</p></td>
</tr>
<tr class="row-odd"><td><p>global-address.ll</p></td>
<td><p>v</p></td>
<td><p>global address, global variable</p></td>
<td><p>6</p></td>
</tr>
<tr class="row-even"><td><p>global-pointer.ll</p></td>
<td><p>v</p></td>
<td><p>global register load and retore, -&gt; .cpload, .cprestore</p></td>
<td><p>9</p></td>
</tr>
<tr class="row-odd"><td><p>gprestore.ll</p></td>
<td><p>v</p></td>
<td><p>global register retore, -&gt; .cprestore</p></td>
<td><p>9</p></td>
</tr>
<tr class="row-even"><td><p>helloworld.ll</p></td>
<td><p>v</p></td>
<td><p>global register load and retore, -&gt; .cpload, .cprestore</p></td>
<td><p>9</p></td>
</tr>
<tr class="row-odd"><td><p>hf16_1.ll</p></td>
<td><p>v</p></td>
<td><p>function call in PIC, -&gt; ld, jalr</p></td>
<td><p>9</p></td>
</tr>
<tr class="row-even"><td><p>i32k.ll</p></td>
<td><p>v</p></td>
<td><p>argument of constant int passing in register</p></td>
<td><p>9</p></td>
</tr>
<tr class="row-odd"><td><p>i64arg.ll</p></td>
<td><p>v</p></td>
<td><p>argument of constant 64-bit passing in register</p></td>
<td><p>9</p></td>
</tr>
<tr class="row-even"><td><p>imm.ll</p></td>
<td><p>v</p></td>
<td><p>return constant 32-bit in register</p></td>
<td><p>9</p></td>
</tr>
<tr class="row-odd"><td><p>indirectcall.ll</p></td>
<td><p>v</p></td>
<td><p>indirect function call</p></td>
<td><p>9</p></td>
</tr>
<tr class="row-even"><td><p>init-array.ll</p></td>
<td><p>v</p></td>
<td><p>check .init</p></td>
<td><p>6</p></td>
</tr>
<tr class="row-odd"><td><p>inlineasm_constraint.ll</p></td>
<td><p>v</p></td>
<td><p>inline asm</p></td>
<td><p>11</p></td>
</tr>
<tr class="row-even"><td><p>inlineasm-cnstrnt-reg.ll</p></td>
<td><p>v</p></td>
<td><ul class="simple">
<li></li>
</ul>
</td>
<td><p>11</p></td>
</tr>
<tr class="row-odd"><td><p>inlineasmmemop.ll</p></td>
<td><p>v</p></td>
<td><ul class="simple">
<li></li>
</ul>
</td>
<td><p>11</p></td>
</tr>
<tr class="row-even"><td><p>inlineasm-operand-code.ll</p></td>
<td><p>v</p></td>
<td><ul class="simple">
<li></li>
</ul>
</td>
<td><p>11</p></td>
</tr>
<tr class="row-odd"><td><p>internalfunc.ll</p></td>
<td><p>v</p></td>
<td><p>internal function</p></td>
<td><p>9</p></td>
</tr>
<tr class="row-even"><td><p>jstat.ll</p></td>
<td><p>v</p></td>
<td><p>switch, -&gt; JTI</p></td>
<td><p>8</p></td>
</tr>
<tr class="row-odd"><td><p>lb1.ll</p></td>
<td><p>v</p></td>
<td><p>load i8*, sext i8, -&gt; lb</p></td>
<td><p>7</p></td>
</tr>
<tr class="row-even"><td><p>lbu1.ll</p></td>
<td><p>v</p></td>
<td><p>load i8*, zext i8, -&gt; lbu</p></td>
<td><p>7</p></td>
</tr>
<tr class="row-odd"><td><p>lh1.ll</p></td>
<td><p>v</p></td>
<td><p>load i16*, sext i16, -&gt; lh</p></td>
<td><p>7</p></td>
</tr>
<tr class="row-even"><td><p>lhu1.ll</p></td>
<td><p>v</p></td>
<td><p>load i16*, zext i16, -&gt; lhu</p></td>
<td><p>7</p></td>
</tr>
<tr class="row-odd"><td><p>llcarry.ll</p></td>
<td><p>v</p></td>
<td><p>64-bit add sub</p></td>
<td><p>7</p></td>
</tr>
<tr class="row-even"><td><p>longbranch.ll</p></td>
<td><p>v</p></td>
<td></td>
<td><p>8</p></td>
</tr>
<tr class="row-odd"><td><p>machineverifier.ll</p></td>
<td><p>v</p></td>
<td><p>delay slot, (comment in machineverifier.ll)</p></td>
<td><p>8</p></td>
</tr>
<tr class="row-even"><td><p>mipslopat.ll</p></td>
<td><p>v</p></td>
<td><p>no check output (comment in mipslopat.ll)</p></td>
<td><p>6</p></td>
</tr>
<tr class="row-odd"><td><p>misha.ll</p></td>
<td><p>v</p></td>
<td><p>miss alignment half word access</p></td>
<td><p>7</p></td>
</tr>
<tr class="row-even"><td><p>module-asm.ll</p></td>
<td><p>v</p></td>
<td><p>module asm</p></td>
<td><p>11</p></td>
</tr>
<tr class="row-odd"><td><p>module-asm-cpu032II.ll</p></td>
<td><p>v</p></td>
<td><p>module asm</p></td>
<td><p>11</p></td>
</tr>
<tr class="row-even"><td><p>mul.ll</p></td>
<td><p>v</p></td>
<td><p>mul</p></td>
<td><p>4</p></td>
</tr>
<tr class="row-odd"><td><p>mulll.ll</p></td>
<td><p>v</p></td>
<td><p>64-bit mul</p></td>
<td><p>4</p></td>
</tr>
<tr class="row-even"><td><p>mulull.ll</p></td>
<td><p>v</p></td>
<td><p>64-bit mul</p></td>
<td><p>4</p></td>
</tr>
<tr class="row-odd"><td><p>not1.ll</p></td>
<td><p>v</p></td>
<td><p>not 1</p></td>
<td><p>4</p></td>
</tr>
<tr class="row-even"><td><p>null.ll</p></td>
<td><p>v</p></td>
<td><p>ret i32 0, -&gt; ret $lr</p></td>
<td><p>3</p></td>
</tr>
<tr class="row-odd"><td><p>o32_cc_byval.ll</p></td>
<td><p>v</p></td>
<td><p>by value</p></td>
<td><p>9</p></td>
</tr>
<tr class="row-even"><td><p>o32_cc_vararg.ll</p></td>
<td><p>v</p></td>
<td><p>variable argument</p></td>
<td><p>9</p></td>
</tr>
<tr class="row-odd"><td><p>private.ll</p></td>
<td><p>v</p></td>
<td><p>private function call</p></td>
<td><p>9</p></td>
</tr>
<tr class="row-even"><td><p>rem.ll</p></td>
<td><p>v</p></td>
<td><p>srem, -&gt; div, mfhi</p></td>
<td><p>4</p></td>
</tr>
<tr class="row-odd"><td><p>remat-immed-load.ll</p></td>
<td><p>v</p></td>
<td><p>immediate load</p></td>
<td><p>3</p></td>
</tr>
<tr class="row-even"><td><p>remul.ll</p></td>
<td><p>v</p></td>
<td><p>urem, -&gt; div, mfhi</p></td>
<td><p>4</p></td>
</tr>
<tr class="row-odd"><td><p>return-vector-float4.ll</p></td>
<td><p>v</p></td>
<td><p>return vector, -&gt; lui lui …</p></td>
<td><p>3</p></td>
</tr>
<tr class="row-even"><td><p>return-vector.ll</p></td>
<td><p>v</p></td>
<td><p>return vector, -&gt; ld ld …, st st …</p></td>
<td><p>3</p></td>
</tr>
<tr class="row-odd"><td><p>return_address.ll</p></td>
<td><p>v</p></td>
<td><p>llvm.returnaddress, -&gt; addu $2, $zero, $lr</p></td>
<td><p>9</p></td>
</tr>
<tr class="row-even"><td><p>rotate.ll</p></td>
<td><p>v</p></td>
<td><p>rotl, rotr, -&gt; rolv, rol, rorv</p></td>
<td><p>4</p></td>
</tr>
<tr class="row-odd"><td><p>sb1.ll</p></td>
<td><p>v</p></td>
<td><p>store i8, sb</p></td>
<td><p>7</p></td>
</tr>
<tr class="row-even"><td><p>select.ll</p></td>
<td><p>v</p></td>
<td><p>select, -&gt; movn, movz</p></td>
<td><p>8</p></td>
</tr>
<tr class="row-odd"><td><p>seleq.ll</p></td>
<td><p>v</p></td>
<td><p>following for br with different condition</p></td>
<td><p>8</p></td>
</tr>
<tr class="row-even"><td><p>seleqk.ll</p></td>
<td><p>v</p></td>
<td><ul class="simple">
<li></li>
</ul>
</td>
<td><p>8</p></td>
</tr>
<tr class="row-odd"><td><p>selgek.ll</p></td>
<td><p>v</p></td>
<td><ul class="simple">
<li></li>
</ul>
</td>
<td><p>8</p></td>
</tr>
<tr class="row-even"><td><p>selgt.ll</p></td>
<td><p>v</p></td>
<td><ul class="simple">
<li></li>
</ul>
</td>
<td><p>8</p></td>
</tr>
<tr class="row-odd"><td><p>selle.ll</p></td>
<td><p>v</p></td>
<td><ul class="simple">
<li></li>
</ul>
</td>
<td><p>8</p></td>
</tr>
<tr class="row-even"><td><p>selltk.ll</p></td>
<td><p>v</p></td>
<td><ul class="simple">
<li></li>
</ul>
</td>
<td><p>8</p></td>
</tr>
<tr class="row-odd"><td><p>selne.ll</p></td>
<td><p>v</p></td>
<td><ul class="simple">
<li></li>
</ul>
</td>
<td><p>8</p></td>
</tr>
<tr class="row-even"><td><p>selnek.ll</p></td>
<td><p>v</p></td>
<td><ul class="simple">
<li></li>
</ul>
</td>
<td><p>8</p></td>
</tr>
<tr class="row-odd"><td><p>seteq.ll</p></td>
<td><p>v</p></td>
<td><ul class="simple">
<li></li>
</ul>
</td>
<td><p>8</p></td>
</tr>
<tr class="row-even"><td><p>seteqz.ll</p></td>
<td><p>v</p></td>
<td><ul class="simple">
<li></li>
</ul>
</td>
<td><p>8</p></td>
</tr>
<tr class="row-odd"><td><p>setge.ll</p></td>
<td><p>v</p></td>
<td><ul class="simple">
<li></li>
</ul>
</td>
<td><p>8</p></td>
</tr>
<tr class="row-even"><td><p>setgek.ll</p></td>
<td><p>v</p></td>
<td><ul class="simple">
<li></li>
</ul>
</td>
<td><p>8</p></td>
</tr>
<tr class="row-odd"><td><p>setle.ll</p></td>
<td><p>v</p></td>
<td><ul class="simple">
<li></li>
</ul>
</td>
<td><p>8</p></td>
</tr>
<tr class="row-even"><td><p>setlt.ll</p></td>
<td><p>v</p></td>
<td><ul class="simple">
<li></li>
</ul>
</td>
<td><p>8</p></td>
</tr>
<tr class="row-odd"><td><p>setltk.ll</p></td>
<td><p>v</p></td>
<td><ul class="simple">
<li></li>
</ul>
</td>
<td><p>8</p></td>
</tr>
<tr class="row-even"><td><p>setne.ll</p></td>
<td><p>v</p></td>
<td><ul class="simple">
<li></li>
</ul>
</td>
<td><p>8</p></td>
</tr>
<tr class="row-odd"><td><p>setuge.ll</p></td>
<td><p>v</p></td>
<td><ul class="simple">
<li></li>
</ul>
</td>
<td><p>8</p></td>
</tr>
<tr class="row-even"><td><p>setugt.ll</p></td>
<td><p>v</p></td>
<td><ul class="simple">
<li></li>
</ul>
</td>
<td><p>8</p></td>
</tr>
<tr class="row-odd"><td><p>setule.ll</p></td>
<td><p>v</p></td>
<td><ul class="simple">
<li></li>
</ul>
</td>
<td><p>8</p></td>
</tr>
<tr class="row-even"><td><p>setult.ll</p></td>
<td><p>v</p></td>
<td><ul class="simple">
<li></li>
</ul>
</td>
<td><p>8</p></td>
</tr>
<tr class="row-odd"><td><p>setultk.ll</p></td>
<td><p>v</p></td>
<td><ul class="simple">
<li></li>
</ul>
</td>
<td><p>8</p></td>
</tr>
<tr class="row-even"><td><p>sext_inreg.ll</p></td>
<td><p>v</p></td>
<td><p>sext i1, -&gt; shl, sra</p></td>
<td><p>4</p></td>
</tr>
<tr class="row-odd"><td><p>shift-parts.ll</p></td>
<td><p>v</p></td>
<td><p>64-bit shl, lshr, ashr, -&gt; call function</p></td>
<td><p>9</p></td>
</tr>
<tr class="row-even"><td><p>shl1.ll</p></td>
<td><p>v</p></td>
<td><p>shl, -&gt; shl</p></td>
<td><p>4</p></td>
</tr>
<tr class="row-odd"><td><p>shl2.ll</p></td>
<td><p>v</p></td>
<td><p>shl, -&gt; shlv</p></td>
<td><p>4</p></td>
</tr>
<tr class="row-even"><td><p>shr1.ll</p></td>
<td><p>v</p></td>
<td><p>shr, -&gt; shr</p></td>
<td><p>4</p></td>
</tr>
<tr class="row-odd"><td><p>shr2.ll</p></td>
<td><p>v</p></td>
<td><p>shr, -&gt; shrv</p></td>
<td><p>4</p></td>
</tr>
<tr class="row-even"><td><p>sitofp-selectcc-opt.ll</p></td>
<td><p>v</p></td>
<td><p>comment in sitofp-selectcc-opt.ll</p></td>
<td><p>7</p></td>
</tr>
<tr class="row-odd"><td><p>small-section-reserve-gp.ll</p></td>
<td><p>v</p></td>
<td><p>Cpu0 option -cpu0-use-small-section=true</p></td>
<td><p>6</p></td>
</tr>
<tr class="row-even"><td><p>sra1.ll</p></td>
<td><p>v</p></td>
<td><p>ashr, -&gt; sra</p></td>
<td><p>4</p></td>
</tr>
<tr class="row-odd"><td><p>sra2.ll</p></td>
<td><p>v</p></td>
<td><p>ashr, -&gt; srav</p></td>
<td><p>4</p></td>
</tr>
<tr class="row-even"><td><p>stacksave-restore.ll</p></td>
<td><p>v</p></td>
<td></td>
<td><p>9</p></td>
</tr>
<tr class="row-odd"><td><p>stacksize.ll</p></td>
<td><p>v</p></td>
<td><p>comment in stacksize.ll</p></td>
<td><p>9</p></td>
</tr>
<tr class="row-even"><td><p>stchar.ll</p></td>
<td><p>v</p></td>
<td><p>load and store i16, i8</p></td>
<td><p>7</p></td>
</tr>
<tr class="row-odd"><td><p>stldst.ll</p></td>
<td><p>v</p></td>
<td><p>register sp spill</p></td>
<td><p>9</p></td>
</tr>
<tr class="row-even"><td><p>sub1.ll</p></td>
<td><p>v</p></td>
<td><p>sub, -&gt; addiu</p></td>
<td><p>4</p></td>
</tr>
<tr class="row-odd"><td><p>sub2.ll</p></td>
<td><p>v</p></td>
<td><p>sub, -&gt; sub</p></td>
<td><p>4</p></td>
</tr>
<tr class="row-even"><td><p>tailcall.ll</p></td>
<td><p>v</p></td>
<td><p>tail call</p></td>
<td><p>9</p></td>
</tr>
<tr class="row-odd"><td><p>tls.ll</p></td>
<td><p>v</p></td>
<td><p>ir thread_local global is for c++ “__thread int b;”</p></td>
<td><p>12</p></td>
</tr>
<tr class="row-even"><td><p>tls-alias.ll</p></td>
<td><p>v</p></td>
<td><p>thread_local global and thread local alias</p></td>
<td><p>12</p></td>
</tr>
<tr class="row-odd"><td><p>tls-models.ll</p></td>
<td><p>v</p></td>
<td><p>ir external/internal thread_local global</p></td>
<td><p>12</p></td>
</tr>
<tr class="row-even"><td><p>uitofp.ll</p></td>
<td><p>v</p></td>
<td><p>integer2float, uitofp, -&gt; jsub __floatunsisf</p></td>
<td><p>9</p></td>
</tr>
<tr class="row-odd"><td><p>uli.ll</p></td>
<td><p>v</p></td>
<td><p>unalignment init, -&gt; sb sb …</p></td>
<td><p>6</p></td>
</tr>
<tr class="row-even"><td><p>unalignedload.ll</p></td>
<td><p>v</p></td>
<td><p>unalignment init, -&gt; sb sb …</p></td>
<td><p>6</p></td>
</tr>
<tr class="row-odd"><td><p>vector-setcc.ll</p></td>
<td><p>v</p></td>
<td></td>
<td><p>7</p></td>
</tr>
<tr class="row-even"><td><p>weak.ll</p></td>
<td><p>v</p></td>
<td><p>extern_weak function, -&gt; .weak</p></td>
<td><p>9</p></td>
</tr>
<tr class="row-odd"><td><p>xor1.ll</p></td>
<td><p>v</p></td>
<td><p>xor, -&gt; xor</p></td>
<td><p>4</p></td>
</tr>
<tr class="row-even"><td><p>zeroreg.ll</p></td>
<td><p>v</p></td>
<td><p>check register $zero</p></td>
<td><p>4</p></td>
</tr>
</tbody>
</table>
<p>These supported test cases are located in <code class="docutils literal notranslate"><span class="pre">lbdex/regression-test/Cpu0</span></code>, which
can be extracted from <code class="docutils literal notranslate"><span class="pre">tar</span> <span class="pre">-xf</span> <span class="pre">lbdex.tar.gz</span></code>.</p>
<p>The regression test is useful for two major reasons. First, it provides the LLVM
input, assembly output, and the corresponding command and options within the same
sample input file. This makes it a well-documented reference for both end users
and developers.</p>
<p>Second, when developers make changes to their backend compiler—especially
for optimization—these tests help detect side effects or bugs caused by the
modifications. This is the core purpose of “regression testing.”</p>
<p>The following file includes the assembly output patterns for two subtargets
of the Cpu0 backend. In addition to checking opcodes, it can also verify
register numbers. For example, the destination register of the “andi” instruction
must match the first source register of the following “xori” instruction. This is
ensured when both are specified as register T1 in the corresponding assembly output.</p>
<p class="rubric">lbdex/regression-test/Cpu0/setule.ll</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span>; RUN: llc  -march=cpu0 -mcpu=cpu032I  -relocation-model=pic -O3 %s -o - | FileCheck %s -check-prefix=cpu032I
; RUN: llc  -march=cpu0 -mcpu=cpu032II  -relocation-model=pic -O3 %s -o - | FileCheck %s -check-prefix=cpu032II

@j = global i32 5, align 4
@k = global i32 10, align 4
@l = global i32 20, align 4
@m = global i32 10, align 4
@r1 = common global i32 0, align 4
@r2 = common global i32 0, align 4
@r3 = common global i32 0, align 4

define void @test() nounwind {
entry:
  %0 = load i32, i32* @j, align 4
  %1 = load i32, i32* @k, align 4
  %cmp = icmp ule i32 %0, %1
  %conv = zext i1 %cmp to i32
  store i32 %conv, i32* @r1, align 4
; cpu032I:  cmp	$sw, ${{[0-9]+|t9}}, ${{[0-9]+|t9}}
; cpu032I:  andi	$[[T1:[0-9]+|t9]], $sw, 1
; cpu032I:  xori	${{[0-9]+|t9}}, $[[T1]], 1
; cpu032II:  sltu	$[[T0:[0-9]+|t9]], ${{[0-9]+|t9}}, ${{[0-9]+|t9}}
; cpu032II:  xori	${{[0-9]+|t9}}, $[[T0]], 1
  %2 = load i32, i32* @m, align 4
  %cmp1 = icmp ule i32 %2, %1
  %conv2 = zext i1 %cmp1 to i32
  store i32 %conv2, i32* @r2, align 4
  ret void
}
</pre></div>
</div>
<p>Running regression tests must occur after building LLVM. However, the following
README.rst and changes in related config files allow you to set up <cite>llvm-lit</cite>
for a pre-built or pre-installed LLVM environment.</p>
<p>This setup enables running <cite>llvm-lit</cite> without rebuilding LLVM, making the
regression testing more efficient when testing changes to the backend only.</p>
<p class="rubric">lbdex/set-llvm-lit/README.txt</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span>llvm-lit can be changed to support the installed clang/llvm. Then llvm-lit can
be run directly without build the clang/llvm.

## Run llvm-lit without building llvm-project

    $ pwd
    $ $HOME/test/llvm/llvm/test/CodeGen/Cpu0
    // change the following to dir for your llvm-project
    $ export LLVM_DIR=$HOME/test/llvm
    $ export LLVM_INSTALLED_DIR=$HOME/llvm-installed
    $ ~/llvm-installed/bin/llvm-lit addc.ll -a
    $ ~/llvm-installed/bin/llvm-lit .
    ~/test/llvm/clang/test/CodeGen/Cpu0$ ~/riscv/riscv_newlib/bin/llvm-lit . -a


</pre></div>
</div>
<p>set-llvm-lit % <cite>diff -r origin modify &amp;&gt; set-llvm-lit.diff</cite></p>
<p class="rubric">lbdex/set-llvm-lit/set-llvm-lit.diff</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">diff</span> <span class="o">-</span><span class="n">r</span> <span class="n">origin</span><span class="o">/</span><span class="nb">bin</span><span class="o">/</span><span class="n">llvm</span><span class="o">-</span><span class="n">lit</span> <span class="n">modify</span><span class="o">/</span><span class="nb">bin</span><span class="o">/</span><span class="n">llvm</span><span class="o">-</span><span class="n">lit</span>
<span class="mi">8</span><span class="n">c8</span>
<span class="o">&lt;</span> <span class="n">install_dir</span> <span class="o">=</span> <span class="sa">r</span><span class="s1">&#39;/usr/local/riscv/andes/riscv_newlib&#39;</span>
<span class="o">---</span>
<span class="o">&gt;</span> <span class="n">install_dir</span> <span class="o">=</span> <span class="n">os</span><span class="o">.</span><span class="n">environ</span><span class="p">[</span><span class="s2">&quot;LLVM_INSTALLED_DIR&quot;</span><span class="p">]</span>
<span class="n">diff</span> <span class="o">-</span><span class="n">r</span> <span class="n">origin</span><span class="o">/</span><span class="n">test</span><span class="o">/</span><span class="n">Unit</span><span class="o">/</span><span class="n">lit</span><span class="o">.</span><span class="n">site</span><span class="o">.</span><span class="n">cfg</span><span class="o">.</span><span class="n">py</span> <span class="n">modify</span><span class="o">/</span><span class="n">test</span><span class="o">/</span><span class="n">Unit</span><span class="o">/</span><span class="n">lit</span><span class="o">.</span><span class="n">site</span><span class="o">.</span><span class="n">cfg</span><span class="o">.</span><span class="n">py</span>
<span class="mi">3</span><span class="n">a4</span><span class="p">,</span><span class="mi">9</span>
<span class="o">&gt;</span> <span class="kn">import</span><span class="w"> </span><span class="nn">os</span>
<span class="o">&gt;</span> 
<span class="o">&gt;</span> <span class="n">llvm_project_dir</span> <span class="o">=</span> <span class="n">os</span><span class="o">.</span><span class="n">environ</span><span class="p">[</span><span class="s2">&quot;PHOENIX_LLVM_DIR&quot;</span><span class="p">]</span>
<span class="o">&gt;</span> <span class="nb">print</span><span class="p">(</span><span class="s1">&#39;llvm_project_dir: &#39;</span><span class="p">,</span> <span class="n">llvm_project_dir</span><span class="p">)</span>
<span class="o">&gt;</span> <span class="n">install_dir</span> <span class="o">=</span> <span class="n">os</span><span class="o">.</span><span class="n">environ</span><span class="p">[</span><span class="s2">&quot;LLVM_INSTALLED_DIR&quot;</span><span class="p">]</span>
<span class="o">&gt;</span> 
<span class="mi">4</span><span class="n">a11</span>
<span class="o">&gt;</span> <span class="kn">from</span><span class="w"> </span><span class="nn">pathlib</span><span class="w"> </span><span class="kn">import</span> <span class="n">Path</span>
<span class="mi">7</span><span class="n">c14</span>
<span class="o">&lt;</span>     <span class="k">return</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">dirname</span><span class="p">(</span><span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">abspath</span><span class="p">(</span><span class="vm">__file__</span><span class="p">)),</span> <span class="n">p</span><span class="p">)</span>
<span class="o">---</span>
<span class="o">&gt;</span>     <span class="k">return</span> <span class="nb">str</span><span class="p">((</span><span class="n">Path</span><span class="p">(</span><span class="vm">__file__</span><span class="p">)</span><span class="o">.</span><span class="n">parent</span> <span class="o">/</span> <span class="n">p</span><span class="p">)</span><span class="o">.</span><span class="n">resolve</span><span class="p">())</span>
<span class="mi">12</span><span class="p">,</span><span class="mi">14</span><span class="n">c19</span><span class="p">,</span><span class="mi">21</span>
<span class="o">&lt;</span> <span class="n">config</span><span class="o">.</span><span class="n">llvm_src_root</span> <span class="o">=</span> <span class="n">path</span><span class="p">(</span><span class="sa">r</span><span class="s2">&quot;/Users/cschen/llvm/test/llvm&quot;</span><span class="p">)</span>
<span class="o">&lt;</span> <span class="n">config</span><span class="o">.</span><span class="n">llvm_obj_root</span> <span class="o">=</span> <span class="n">path</span><span class="p">(</span><span class="sa">r</span><span class="s2">&quot;/Users/cschen/llvm/test/build&quot;</span><span class="p">)</span>
<span class="o">&lt;</span> <span class="n">config</span><span class="o">.</span><span class="n">llvm_tools_dir</span> <span class="o">=</span> <span class="n">path</span><span class="p">(</span><span class="sa">r</span><span class="s2">&quot;/Users/cschen/llvm/test/build/./bin&quot;</span><span class="p">)</span>
<span class="o">---</span>
<span class="o">&gt;</span> <span class="n">config</span><span class="o">.</span><span class="n">llvm_src_root</span> <span class="o">=</span> <span class="n">path</span><span class="p">(</span><span class="n">llvm_project_dir</span><span class="p">)</span><span class="o">+</span><span class="n">path</span><span class="p">(</span><span class="sa">r</span><span class="s2">&quot;/llvm&quot;</span><span class="p">)</span>
<span class="o">&gt;</span> <span class="n">config</span><span class="o">.</span><span class="n">llvm_obj_root</span> <span class="o">=</span> <span class="n">path</span><span class="p">(</span><span class="n">install_dir</span><span class="p">)</span>
<span class="o">&gt;</span> <span class="n">config</span><span class="o">.</span><span class="n">llvm_tools_dir</span> <span class="o">=</span> <span class="n">path</span><span class="p">(</span><span class="n">install_dir</span><span class="p">)</span><span class="o">+</span><span class="n">path</span><span class="p">(</span><span class="sa">r</span><span class="s2">&quot;/./bin&quot;</span><span class="p">)</span>
<span class="mi">17</span><span class="n">c24</span>
<span class="o">&lt;</span> <span class="n">config</span><span class="o">.</span><span class="n">shlibdir</span> <span class="o">=</span> <span class="n">path</span><span class="p">(</span><span class="sa">r</span><span class="s2">&quot;/Users/cschen/llvm/test/build/./lib&quot;</span><span class="p">)</span>
<span class="o">---</span>
<span class="o">&gt;</span> <span class="n">config</span><span class="o">.</span><span class="n">shlibdir</span> <span class="o">=</span> <span class="n">path</span><span class="p">(</span><span class="n">install_dir</span><span class="p">)</span><span class="o">+</span><span class="n">path</span><span class="p">(</span><span class="sa">r</span><span class="s2">&quot;/./lib&quot;</span><span class="p">)</span>
<span class="mi">23</span><span class="n">a31</span>
<span class="o">&gt;</span>     <span class="n">config</span><span class="o">.</span><span class="n">shlibdir</span> <span class="o">=</span> <span class="n">config</span><span class="o">.</span><span class="n">shlibdir</span> <span class="o">%</span> <span class="n">lit_config</span><span class="o">.</span><span class="n">params</span>
<span class="n">diff</span> <span class="o">-</span><span class="n">r</span> <span class="n">origin</span><span class="o">/</span><span class="n">test</span><span class="o">/</span><span class="n">lit</span><span class="o">.</span><span class="n">site</span><span class="o">.</span><span class="n">cfg</span><span class="o">.</span><span class="n">py</span> <span class="n">modify</span><span class="o">/</span><span class="n">test</span><span class="o">/</span><span class="n">lit</span><span class="o">.</span><span class="n">site</span><span class="o">.</span><span class="n">cfg</span><span class="o">.</span><span class="n">py</span>
<span class="mi">1</span><span class="n">c1</span>
<span class="o">&lt;</span> <span class="c1"># Autogenerated from /Users/cschen/llvm/test/llvm/test/lit.site.cfg.py.in</span>
<span class="o">---</span>
<span class="o">&gt;</span> <span class="c1"># Autogenerated from /u/jonathanchen/andes/riscv/Phoenix/llvm-project/llvm/test/lit.site.cfg.py.in</span>
<span class="mi">3</span><span class="n">a4</span><span class="p">,</span><span class="mi">9</span>
<span class="o">&gt;</span> <span class="kn">import</span><span class="w"> </span><span class="nn">os</span>
<span class="o">&gt;</span> 
<span class="o">&gt;</span> <span class="n">llvm_project_dir</span> <span class="o">=</span> <span class="n">os</span><span class="o">.</span><span class="n">environ</span><span class="p">[</span><span class="s2">&quot;PHOENIX_LLVM_DIR&quot;</span><span class="p">]</span>
<span class="o">&gt;</span> <span class="nb">print</span><span class="p">(</span><span class="s1">&#39;llvm_project_dir: &#39;</span><span class="p">,</span> <span class="n">llvm_project_dir</span><span class="p">)</span>
<span class="o">&gt;</span> <span class="n">install_dir</span> <span class="o">=</span> <span class="sa">r</span><span class="s1">&#39;/usr/local/riscv/andes/riscv_newlib&#39;</span>
<span class="o">&gt;</span> 
<span class="mi">4</span><span class="n">a11</span>
<span class="o">&gt;</span> <span class="kn">from</span><span class="w"> </span><span class="nn">pathlib</span><span class="w"> </span><span class="kn">import</span> <span class="n">Path</span>
<span class="mi">7</span><span class="n">c14</span>
<span class="o">&lt;</span>     <span class="k">return</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">dirname</span><span class="p">(</span><span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">abspath</span><span class="p">(</span><span class="vm">__file__</span><span class="p">)),</span> <span class="n">p</span><span class="p">)</span>
<span class="o">---</span>
<span class="o">&gt;</span>     <span class="k">return</span> <span class="nb">str</span><span class="p">((</span><span class="n">Path</span><span class="p">(</span><span class="vm">__file__</span><span class="p">)</span><span class="o">.</span><span class="n">parent</span> <span class="o">/</span> <span class="n">p</span><span class="p">)</span><span class="o">.</span><span class="n">resolve</span><span class="p">())</span>
<span class="mi">12</span><span class="p">,</span><span class="mi">19</span><span class="n">c19</span><span class="p">,</span><span class="mi">27</span>
<span class="o">&lt;</span> <span class="n">config</span><span class="o">.</span><span class="n">host_triple</span> <span class="o">=</span> <span class="s2">&quot;arm64-apple-darwin20.6.0&quot;</span>
<span class="o">&lt;</span> <span class="n">config</span><span class="o">.</span><span class="n">target_triple</span> <span class="o">=</span> <span class="s2">&quot;cpu0-unknown-elf&quot;</span>
<span class="o">&lt;</span> <span class="n">config</span><span class="o">.</span><span class="n">llvm_src_root</span> <span class="o">=</span> <span class="n">path</span><span class="p">(</span><span class="sa">r</span><span class="s2">&quot;/Users/cschen/llvm/test/llvm&quot;</span><span class="p">)</span>
<span class="o">&lt;</span> <span class="n">config</span><span class="o">.</span><span class="n">llvm_obj_root</span> <span class="o">=</span> <span class="n">path</span><span class="p">(</span><span class="sa">r</span><span class="s2">&quot;/Users/cschen/llvm/test/build&quot;</span><span class="p">)</span>
<span class="o">&lt;</span> <span class="n">config</span><span class="o">.</span><span class="n">llvm_tools_dir</span> <span class="o">=</span> <span class="n">path</span><span class="p">(</span><span class="sa">r</span><span class="s2">&quot;/Users/cschen/llvm/test/build/./bin&quot;</span><span class="p">)</span>
<span class="o">&lt;</span> <span class="n">config</span><span class="o">.</span><span class="n">llvm_lib_dir</span> <span class="o">=</span> <span class="n">path</span><span class="p">(</span><span class="sa">r</span><span class="s2">&quot;/Users/cschen/llvm/test/build/./lib&quot;</span><span class="p">)</span>
<span class="o">&lt;</span> <span class="n">config</span><span class="o">.</span><span class="n">llvm_shlib_dir</span> <span class="o">=</span> <span class="n">path</span><span class="p">(</span><span class="sa">r</span><span class="s2">&quot;/Users/cschen/llvm/test/build/./lib&quot;</span><span class="p">)</span>
<span class="o">&lt;</span> <span class="n">config</span><span class="o">.</span><span class="n">llvm_shlib_ext</span> <span class="o">=</span> <span class="s2">&quot;.dylib&quot;</span>
<span class="o">---</span>
<span class="o">&gt;</span> <span class="n">config</span><span class="o">.</span><span class="n">host_triple</span> <span class="o">=</span> <span class="s2">&quot;x86_64-unknown-linux-gnu&quot;</span>
<span class="o">&gt;</span> <span class="n">config</span><span class="o">.</span><span class="n">target_triple</span> <span class="o">=</span> <span class="s2">&quot;riscv64-unknown-elf&quot;</span>
<span class="o">&gt;</span> <span class="n">config</span><span class="o">.</span><span class="n">llvm_src_root</span> <span class="o">=</span> <span class="n">path</span><span class="p">(</span><span class="n">llvm_project_dir</span><span class="p">)</span><span class="o">+</span><span class="n">path</span><span class="p">(</span><span class="sa">r</span><span class="s2">&quot;/llvm&quot;</span><span class="p">)</span>
<span class="o">&gt;</span> <span class="n">config</span><span class="o">.</span><span class="n">llvm_obj_root</span> <span class="o">=</span> <span class="n">path</span><span class="p">(</span><span class="n">install_dir</span><span class="p">)</span>
<span class="o">&gt;</span> <span class="n">config</span><span class="o">.</span><span class="n">llvm_tools_dir</span> <span class="o">=</span> <span class="n">path</span><span class="p">(</span><span class="n">install_dir</span><span class="p">)</span><span class="o">+</span><span class="n">path</span><span class="p">(</span><span class="sa">r</span><span class="s2">&quot;/./bin&quot;</span><span class="p">)</span>
<span class="o">&gt;</span> <span class="n">config</span><span class="o">.</span><span class="n">llvm_lib_dir</span> <span class="o">=</span> <span class="n">path</span><span class="p">(</span><span class="n">install_dir</span><span class="p">)</span><span class="o">+</span><span class="n">path</span><span class="p">(</span><span class="sa">r</span><span class="s2">&quot;/./lib&quot;</span><span class="p">)</span>
<span class="o">&gt;</span> <span class="n">config</span><span class="o">.</span><span class="n">llvm_shlib_dir</span> <span class="o">=</span> <span class="n">path</span><span class="p">(</span><span class="n">install_dir</span><span class="p">)</span><span class="o">+</span><span class="n">path</span><span class="p">(</span><span class="sa">r</span><span class="s2">&quot;/./lib&quot;</span><span class="p">)</span>
<span class="o">&gt;</span> <span class="n">config</span><span class="o">.</span><span class="n">llvm_shlib_ext</span> <span class="o">=</span> <span class="s2">&quot;.so&quot;</span>
<span class="o">&gt;</span> <span class="n">config</span><span class="o">.</span><span class="n">llvm_plugin_ext</span> <span class="o">=</span> <span class="s2">&quot;.so&quot;</span>
<span class="mi">22</span><span class="p">,</span><span class="mi">24</span><span class="n">c30</span><span class="p">,</span><span class="mi">34</span>
<span class="o">&lt;</span> <span class="n">config</span><span class="o">.</span><span class="n">python_executable</span> <span class="o">=</span> <span class="s2">&quot;/opt/homebrew/Frameworks/Python.framework/Versions/3.9/bin/python3.9&quot;</span>
<span class="o">&lt;</span> <span class="n">config</span><span class="o">.</span><span class="n">gold_executable</span> <span class="o">=</span> <span class="s2">&quot;/opt/homebrew/bin/riscv64-unknown-elf-ld&quot;</span>
<span class="o">&lt;</span> <span class="n">config</span><span class="o">.</span><span class="n">ld64_executable</span> <span class="o">=</span> <span class="s2">&quot;/Applications/Xcode.app/Contents/Developer/Toolchains/XcodeDefault.xctoolchain/usr/bin/ld&quot;</span>
<span class="o">---</span>
<span class="o">&gt;</span> <span class="n">config</span><span class="o">.</span><span class="n">errc_messages</span> <span class="o">=</span> <span class="s2">&quot;No such file or directory;Is a directory;Invalid argument;Permission denied&quot;</span>
<span class="o">&gt;</span> <span class="n">config</span><span class="o">.</span><span class="n">python_executable</span> <span class="o">=</span> <span class="s2">&quot;/usr/bin/python3.6&quot;</span>
<span class="o">&gt;</span> <span class="n">config</span><span class="o">.</span><span class="n">gold_executable</span> <span class="o">=</span> <span class="s2">&quot;/usr/bin/ld.gold&quot;</span>
<span class="o">&gt;</span> <span class="n">config</span><span class="o">.</span><span class="n">ld64_executable</span> <span class="o">=</span> <span class="s2">&quot;&quot;</span>
<span class="o">&gt;</span> <span class="n">config</span><span class="o">.</span><span class="n">osx_sysroot</span> <span class="o">=</span> <span class="n">path</span><span class="p">(</span><span class="sa">r</span><span class="s2">&quot;&quot;</span><span class="p">)</span>
<span class="mi">33</span><span class="p">,</span><span class="mi">34</span><span class="n">c43</span><span class="p">,</span><span class="mi">44</span>
<span class="o">&lt;</span> <span class="n">config</span><span class="o">.</span><span class="n">targets_to_build</span> <span class="o">=</span> <span class="s2">&quot; Cpu0&quot;</span>
<span class="o">&lt;</span> <span class="n">config</span><span class="o">.</span><span class="n">native_target</span> <span class="o">=</span> <span class="s2">&quot;AArch64&quot;</span>
<span class="o">---</span>
<span class="o">&gt;</span> <span class="n">config</span><span class="o">.</span><span class="n">targets_to_build</span> <span class="o">=</span> <span class="s2">&quot; RISCV&quot;</span>
<span class="o">&gt;</span> <span class="n">config</span><span class="o">.</span><span class="n">native_target</span> <span class="o">=</span> <span class="s2">&quot;X86&quot;</span>
<span class="mi">36</span><span class="p">,</span><span class="mi">38</span><span class="n">c46</span><span class="p">,</span><span class="mi">48</span>
<span class="o">&lt;</span> <span class="n">config</span><span class="o">.</span><span class="n">host_os</span> <span class="o">=</span> <span class="s2">&quot;Darwin&quot;</span>
<span class="o">&lt;</span> <span class="n">config</span><span class="o">.</span><span class="n">host_cc</span> <span class="o">=</span> <span class="s2">&quot;/opt/homebrew/opt/llvm/bin/clang &quot;</span>
<span class="o">&lt;</span> <span class="n">config</span><span class="o">.</span><span class="n">host_cxx</span> <span class="o">=</span> <span class="s2">&quot;/opt/homebrew/opt/llvm/bin/clang++ &quot;</span>
<span class="o">---</span>
<span class="o">&gt;</span> <span class="n">config</span><span class="o">.</span><span class="n">host_os</span> <span class="o">=</span> <span class="s2">&quot;Linux&quot;</span>
<span class="o">&gt;</span> <span class="n">config</span><span class="o">.</span><span class="n">host_cc</span> <span class="o">=</span> <span class="s2">&quot;/usr/bin/cc &quot;</span>
<span class="o">&gt;</span> <span class="n">config</span><span class="o">.</span><span class="n">host_cxx</span> <span class="o">=</span> <span class="s2">&quot;/usr/bin/c++ &quot;</span>
<span class="mi">44</span><span class="p">,</span><span class="mi">45</span><span class="n">c54</span><span class="p">,</span><span class="mi">55</span>
<span class="o">&lt;</span> <span class="n">config</span><span class="o">.</span><span class="n">have_libxar</span> <span class="o">=</span> <span class="mi">1</span>
<span class="o">&lt;</span> <span class="n">config</span><span class="o">.</span><span class="n">have_libxml2</span> <span class="o">=</span> <span class="mi">1</span>
<span class="o">---</span>
<span class="o">&gt;</span> <span class="n">config</span><span class="o">.</span><span class="n">have_libxar</span> <span class="o">=</span> <span class="mi">0</span>
<span class="o">&gt;</span> <span class="n">config</span><span class="o">.</span><span class="n">have_libxml2</span> <span class="o">=</span> <span class="mi">0</span>
<span class="mi">52</span><span class="p">,</span><span class="mi">53</span><span class="n">c62</span><span class="p">,</span><span class="mi">63</span>
<span class="o">&lt;</span> <span class="n">config</span><span class="o">.</span><span class="n">llvm_host_triple</span> <span class="o">=</span> <span class="s1">&#39;arm64-apple-darwin20.6.0&#39;</span>
<span class="o">&lt;</span> <span class="n">config</span><span class="o">.</span><span class="n">host_arch</span> <span class="o">=</span> <span class="s2">&quot;arm64&quot;</span>
<span class="o">---</span>
<span class="o">&gt;</span> <span class="n">config</span><span class="o">.</span><span class="n">llvm_host_triple</span> <span class="o">=</span> <span class="s1">&#39;x86_64-unknown-linux-gnu&#39;</span>
<span class="o">&gt;</span> <span class="n">config</span><span class="o">.</span><span class="n">host_arch</span> <span class="o">=</span> <span class="s2">&quot;x86_64&quot;</span>
<span class="mi">65</span><span class="n">a76</span>
<span class="o">&gt;</span>     <span class="n">config</span><span class="o">.</span><span class="n">llvm_lib_dir</span> <span class="o">=</span> <span class="n">config</span><span class="o">.</span><span class="n">llvm_lib_dir</span> <span class="o">%</span> <span class="n">lit_config</span><span class="o">.</span><span class="n">params</span>
<span class="n">diff</span> <span class="o">-</span><span class="n">r</span> <span class="n">origin</span><span class="o">/</span><span class="n">tools</span><span class="o">/</span><span class="n">clang</span><span class="o">/</span><span class="n">test</span><span class="o">/</span><span class="n">Unit</span><span class="o">/</span><span class="n">lit</span><span class="o">.</span><span class="n">site</span><span class="o">.</span><span class="n">cfg</span><span class="o">.</span><span class="n">py</span> <span class="n">modify</span><span class="o">/</span><span class="n">tools</span><span class="o">/</span><span class="n">clang</span><span class="o">/</span><span class="n">test</span><span class="o">/</span><span class="n">Unit</span><span class="o">/</span><span class="n">lit</span><span class="o">.</span><span class="n">site</span><span class="o">.</span><span class="n">cfg</span><span class="o">.</span><span class="n">py</span>
<span class="mi">3</span><span class="n">a4</span><span class="p">,</span><span class="mi">9</span>
<span class="o">&gt;</span> <span class="kn">import</span><span class="w"> </span><span class="nn">os</span>
<span class="o">&gt;</span> 
<span class="o">&gt;</span> <span class="n">llvm_project_dir</span> <span class="o">=</span> <span class="n">os</span><span class="o">.</span><span class="n">environ</span><span class="p">[</span><span class="s2">&quot;LLVM_DIR&quot;</span><span class="p">]</span>
<span class="o">&gt;</span> <span class="nb">print</span><span class="p">(</span><span class="s1">&#39;llvm_project_dir: &#39;</span><span class="p">,</span> <span class="n">llvm_project_dir</span><span class="p">)</span>
<span class="o">&gt;</span> <span class="n">install_dir</span> <span class="o">=</span> <span class="n">os</span><span class="o">.</span><span class="n">environ</span><span class="p">[</span><span class="s2">&quot;LLVM_INSTALLED_DIR&quot;</span><span class="p">]</span>
<span class="o">&gt;</span> 
<span class="mi">4</span><span class="n">a11</span>
<span class="o">&gt;</span> <span class="kn">from</span><span class="w"> </span><span class="nn">pathlib</span><span class="w"> </span><span class="kn">import</span> <span class="n">Path</span>
<span class="mi">7</span><span class="n">c14</span>
<span class="o">&lt;</span>     <span class="k">return</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">dirname</span><span class="p">(</span><span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">abspath</span><span class="p">(</span><span class="vm">__file__</span><span class="p">)),</span> <span class="n">p</span><span class="p">)</span>
<span class="o">---</span>
<span class="o">&gt;</span>     <span class="k">return</span> <span class="nb">str</span><span class="p">((</span><span class="n">Path</span><span class="p">(</span><span class="vm">__file__</span><span class="p">)</span><span class="o">.</span><span class="n">parent</span> <span class="o">/</span> <span class="n">p</span><span class="p">)</span><span class="o">.</span><span class="n">resolve</span><span class="p">())</span>
<span class="mi">12</span><span class="p">,</span><span class="mi">15</span><span class="n">c19</span><span class="p">,</span><span class="mi">22</span>
<span class="o">&lt;</span> <span class="n">config</span><span class="o">.</span><span class="n">llvm_src_root</span> <span class="o">=</span> <span class="n">path</span><span class="p">(</span><span class="sa">r</span><span class="s2">&quot;/Users/cschen/llvm/test/llvm&quot;</span><span class="p">)</span>
<span class="o">&lt;</span> <span class="n">config</span><span class="o">.</span><span class="n">llvm_obj_root</span> <span class="o">=</span> <span class="n">path</span><span class="p">(</span><span class="sa">r</span><span class="s2">&quot;/Users/cschen/llvm/test/build&quot;</span><span class="p">)</span>
<span class="o">&lt;</span> <span class="n">config</span><span class="o">.</span><span class="n">llvm_tools_dir</span> <span class="o">=</span> <span class="n">path</span><span class="p">(</span><span class="sa">r</span><span class="s2">&quot;/Users/cschen/llvm/test/build/./bin&quot;</span><span class="p">)</span>
<span class="o">&lt;</span> <span class="n">config</span><span class="o">.</span><span class="n">llvm_libs_dir</span> <span class="o">=</span> <span class="n">path</span><span class="p">(</span><span class="sa">r</span><span class="s2">&quot;/Users/cschen/llvm/test/build/./lib&quot;</span><span class="p">)</span>
<span class="o">---</span>
<span class="o">&gt;</span> <span class="n">config</span><span class="o">.</span><span class="n">llvm_src_root</span> <span class="o">=</span> <span class="n">path</span><span class="p">(</span><span class="n">llvm_project_dir</span><span class="p">)</span><span class="o">+</span><span class="n">path</span><span class="p">(</span><span class="sa">r</span><span class="s2">&quot;/llvm&quot;</span><span class="p">)</span>
<span class="o">&gt;</span> <span class="n">config</span><span class="o">.</span><span class="n">llvm_obj_root</span> <span class="o">=</span> <span class="n">path</span><span class="p">(</span><span class="n">install_dir</span><span class="p">)</span>
<span class="o">&gt;</span> <span class="n">config</span><span class="o">.</span><span class="n">llvm_tools_dir</span> <span class="o">=</span> <span class="n">path</span><span class="p">(</span><span class="n">install_dir</span><span class="p">)</span><span class="o">+</span><span class="n">path</span><span class="p">(</span><span class="sa">r</span><span class="s2">&quot;/./bin&quot;</span><span class="p">)</span>
<span class="o">&gt;</span> <span class="n">config</span><span class="o">.</span><span class="n">llvm_libs_dir</span> <span class="o">=</span> <span class="n">path</span><span class="p">(</span><span class="n">install_dir</span><span class="p">)</span><span class="o">+</span><span class="n">path</span><span class="p">(</span><span class="sa">r</span><span class="s2">&quot;/./lib&quot;</span><span class="p">)</span>
<span class="mi">17</span><span class="n">c24</span>
<span class="o">&lt;</span> <span class="n">config</span><span class="o">.</span><span class="n">clang_obj_root</span> <span class="o">=</span> <span class="n">path</span><span class="p">(</span><span class="sa">r</span><span class="s2">&quot;/Users/cschen/llvm/test/build/tools/clang&quot;</span><span class="p">)</span>
<span class="o">---</span>
<span class="o">&gt;</span> <span class="n">config</span><span class="o">.</span><span class="n">clang_obj_root</span> <span class="o">=</span> <span class="n">path</span><span class="p">(</span><span class="n">install_dir</span><span class="p">)</span><span class="o">+</span><span class="n">path</span><span class="p">(</span><span class="sa">r</span><span class="s2">&quot;/tools/clang&quot;</span><span class="p">)</span>
<span class="mi">19</span><span class="p">,</span><span class="mi">20</span><span class="n">c26</span><span class="p">,</span><span class="mi">27</span>
<span class="o">&lt;</span> <span class="n">config</span><span class="o">.</span><span class="n">shlibdir</span> <span class="o">=</span> <span class="n">path</span><span class="p">(</span><span class="sa">r</span><span class="s2">&quot;/Users/cschen/llvm/test/build/./lib&quot;</span><span class="p">)</span>
<span class="o">&lt;</span> <span class="n">config</span><span class="o">.</span><span class="n">target_triple</span> <span class="o">=</span> <span class="s2">&quot;cpu0-unknown-elf&quot;</span>
<span class="o">---</span>
<span class="o">&gt;</span> <span class="n">config</span><span class="o">.</span><span class="n">shlibdir</span> <span class="o">=</span> <span class="n">path</span><span class="p">(</span><span class="n">install_dir</span><span class="p">)</span><span class="o">+</span><span class="n">path</span><span class="p">(</span><span class="sa">r</span><span class="s2">&quot;/./lib&quot;</span><span class="p">)</span>
<span class="o">&gt;</span> <span class="n">config</span><span class="o">.</span><span class="n">target_triple</span> <span class="o">=</span> <span class="s2">&quot;riscv64-unknown-elf&quot;</span>
<span class="mi">28</span><span class="n">a36</span>
<span class="o">&gt;</span>     <span class="n">config</span><span class="o">.</span><span class="n">shlibdir</span> <span class="o">=</span> <span class="n">config</span><span class="o">.</span><span class="n">shlibdir</span> <span class="o">%</span> <span class="n">lit_config</span><span class="o">.</span><span class="n">params</span>
<span class="mi">36</span><span class="n">c44</span>
<span class="o">&lt;</span>     <span class="n">config</span><span class="p">,</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">path</span><span class="p">(</span><span class="sa">r</span><span class="s2">&quot;/Users/cschen/llvm/test/clang&quot;</span><span class="p">),</span> <span class="s2">&quot;test/Unit/lit.cfg.py&quot;</span><span class="p">))</span>
<span class="o">---</span>
<span class="o">&gt;</span>     <span class="n">config</span><span class="p">,</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">path</span><span class="p">(</span><span class="n">llvm_project_dir</span><span class="p">)</span><span class="o">+</span><span class="n">path</span><span class="p">(</span><span class="sa">r</span><span class="s2">&quot;/clang&quot;</span><span class="p">),</span> <span class="s2">&quot;test/Unit/lit.cfg.py&quot;</span><span class="p">))</span>
<span class="n">diff</span> <span class="o">-</span><span class="n">r</span> <span class="n">origin</span><span class="o">/</span><span class="n">tools</span><span class="o">/</span><span class="n">clang</span><span class="o">/</span><span class="n">test</span><span class="o">/</span><span class="n">lit</span><span class="o">.</span><span class="n">site</span><span class="o">.</span><span class="n">cfg</span><span class="o">.</span><span class="n">py</span> <span class="n">modify</span><span class="o">/</span><span class="n">tools</span><span class="o">/</span><span class="n">clang</span><span class="o">/</span><span class="n">test</span><span class="o">/</span><span class="n">lit</span><span class="o">.</span><span class="n">site</span><span class="o">.</span><span class="n">cfg</span><span class="o">.</span><span class="n">py</span>
<span class="mi">3</span><span class="n">a4</span><span class="p">,</span><span class="mi">9</span>
<span class="o">&gt;</span> <span class="kn">import</span><span class="w"> </span><span class="nn">os</span>
<span class="o">&gt;</span> 
<span class="o">&gt;</span> <span class="n">llvm_project_dir</span> <span class="o">=</span> <span class="n">os</span><span class="o">.</span><span class="n">environ</span><span class="p">[</span><span class="s2">&quot;LLVM_DIR&quot;</span><span class="p">]</span>
<span class="o">&gt;</span> <span class="nb">print</span><span class="p">(</span><span class="s1">&#39;llvm_project_dir: &#39;</span><span class="p">,</span> <span class="n">llvm_project_dir</span><span class="p">)</span>
<span class="o">&gt;</span> <span class="n">install_dir</span> <span class="o">=</span> <span class="n">os</span><span class="o">.</span><span class="n">environ</span><span class="p">[</span><span class="s2">&quot;LLVM_INSTALLED_DIR&quot;</span><span class="p">]</span>
<span class="o">&gt;</span> 
<span class="mi">4</span><span class="n">a11</span>
<span class="o">&gt;</span> <span class="kn">from</span><span class="w"> </span><span class="nn">pathlib</span><span class="w"> </span><span class="kn">import</span> <span class="n">Path</span>
<span class="mi">7</span><span class="n">c14</span>
<span class="o">&lt;</span>     <span class="k">return</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">dirname</span><span class="p">(</span><span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">abspath</span><span class="p">(</span><span class="vm">__file__</span><span class="p">)),</span> <span class="n">p</span><span class="p">)</span>
<span class="o">---</span>
<span class="o">&gt;</span>     <span class="k">return</span> <span class="nb">str</span><span class="p">((</span><span class="n">Path</span><span class="p">(</span><span class="vm">__file__</span><span class="p">)</span><span class="o">.</span><span class="n">parent</span> <span class="o">/</span> <span class="n">p</span><span class="p">)</span><span class="o">.</span><span class="n">resolve</span><span class="p">())</span>
<span class="mi">12</span><span class="p">,</span><span class="mi">17</span><span class="n">c19</span><span class="p">,</span><span class="mi">24</span>
<span class="o">&lt;</span> <span class="n">config</span><span class="o">.</span><span class="n">llvm_src_root</span> <span class="o">=</span> <span class="n">path</span><span class="p">(</span><span class="sa">r</span><span class="s2">&quot;/Users/cschen/llvm/test/llvm&quot;</span><span class="p">)</span>
<span class="o">&lt;</span> <span class="n">config</span><span class="o">.</span><span class="n">llvm_obj_root</span> <span class="o">=</span> <span class="n">path</span><span class="p">(</span><span class="sa">r</span><span class="s2">&quot;/Users/cschen/llvm/test/build&quot;</span><span class="p">)</span>
<span class="o">&lt;</span> <span class="n">config</span><span class="o">.</span><span class="n">llvm_tools_dir</span> <span class="o">=</span> <span class="n">path</span><span class="p">(</span><span class="sa">r</span><span class="s2">&quot;/Users/cschen/llvm/test/build/./bin&quot;</span><span class="p">)</span>
<span class="o">&lt;</span> <span class="n">config</span><span class="o">.</span><span class="n">llvm_libs_dir</span> <span class="o">=</span> <span class="n">path</span><span class="p">(</span><span class="sa">r</span><span class="s2">&quot;/Users/cschen/llvm/test/build/./lib&quot;</span><span class="p">)</span>
<span class="o">&lt;</span> <span class="n">config</span><span class="o">.</span><span class="n">llvm_shlib_dir</span> <span class="o">=</span> <span class="n">path</span><span class="p">(</span><span class="sa">r</span><span class="s2">&quot;/Users/cschen/llvm/test/build/./lib&quot;</span><span class="p">)</span>
<span class="o">&lt;</span> <span class="n">config</span><span class="o">.</span><span class="n">llvm_plugin_ext</span> <span class="o">=</span> <span class="s2">&quot;.dylib&quot;</span>
<span class="o">---</span>
<span class="o">&gt;</span> <span class="n">config</span><span class="o">.</span><span class="n">llvm_src_root</span> <span class="o">=</span> <span class="n">path</span><span class="p">(</span><span class="n">llvm_project_dir</span><span class="p">)</span><span class="o">+</span><span class="n">path</span><span class="p">(</span><span class="sa">r</span><span class="s2">&quot;/llvm&quot;</span><span class="p">)</span>
<span class="o">&gt;</span> <span class="n">config</span><span class="o">.</span><span class="n">llvm_obj_root</span> <span class="o">=</span> <span class="n">path</span><span class="p">(</span><span class="n">install_dir</span><span class="p">)</span>
<span class="o">&gt;</span> <span class="n">config</span><span class="o">.</span><span class="n">llvm_tools_dir</span> <span class="o">=</span> <span class="n">path</span><span class="p">(</span><span class="n">install_dir</span><span class="p">)</span><span class="o">+</span><span class="n">path</span><span class="p">(</span><span class="sa">r</span><span class="s2">&quot;/./bin&quot;</span><span class="p">)</span>
<span class="o">&gt;</span> <span class="n">config</span><span class="o">.</span><span class="n">llvm_libs_dir</span> <span class="o">=</span> <span class="n">path</span><span class="p">(</span><span class="n">install_dir</span><span class="p">)</span><span class="o">+</span><span class="n">path</span><span class="p">(</span><span class="sa">r</span><span class="s2">&quot;/./lib&quot;</span><span class="p">)</span>
<span class="o">&gt;</span> <span class="n">config</span><span class="o">.</span><span class="n">llvm_shlib_dir</span> <span class="o">=</span> <span class="n">path</span><span class="p">(</span><span class="n">install_dir</span><span class="p">)</span><span class="o">+</span><span class="n">path</span><span class="p">(</span><span class="sa">r</span><span class="s2">&quot;/./lib&quot;</span><span class="p">)</span>
<span class="o">&gt;</span> <span class="n">config</span><span class="o">.</span><span class="n">llvm_plugin_ext</span> <span class="o">=</span> <span class="s2">&quot;.so&quot;</span>
<span class="mi">19</span><span class="p">,</span><span class="mi">24</span><span class="n">c26</span><span class="p">,</span><span class="mi">35</span>
<span class="o">&lt;</span> <span class="n">config</span><span class="o">.</span><span class="n">clang_obj_root</span> <span class="o">=</span> <span class="n">path</span><span class="p">(</span><span class="sa">r</span><span class="s2">&quot;/Users/cschen/llvm/test/build/tools/clang&quot;</span><span class="p">)</span>
<span class="o">&lt;</span> <span class="n">config</span><span class="o">.</span><span class="n">clang_src_dir</span> <span class="o">=</span> <span class="n">path</span><span class="p">(</span><span class="sa">r</span><span class="s2">&quot;/Users/cschen/llvm/test/clang&quot;</span><span class="p">)</span>
<span class="o">&lt;</span> <span class="n">config</span><span class="o">.</span><span class="n">clang_tools_dir</span> <span class="o">=</span> <span class="n">path</span><span class="p">(</span><span class="sa">r</span><span class="s2">&quot;/Users/cschen/llvm/test/build/./bin&quot;</span><span class="p">)</span>
<span class="o">&lt;</span> <span class="n">config</span><span class="o">.</span><span class="n">host_triple</span> <span class="o">=</span> <span class="s2">&quot;arm64-apple-darwin20.6.0&quot;</span>
<span class="o">&lt;</span> <span class="n">config</span><span class="o">.</span><span class="n">target_triple</span> <span class="o">=</span> <span class="s2">&quot;cpu0-unknown-elf&quot;</span>
<span class="o">&lt;</span> <span class="n">config</span><span class="o">.</span><span class="n">host_cxx</span> <span class="o">=</span> <span class="s2">&quot;/opt/homebrew/opt/llvm/bin/clang++&quot;</span>
<span class="o">---</span>
<span class="o">&gt;</span> <span class="n">config</span><span class="o">.</span><span class="n">errc_messages</span> <span class="o">=</span> <span class="s2">&quot;No such file or directory;Is a directory;Invalid argument;Permission denied&quot;</span>
<span class="o">&gt;</span> <span class="n">config</span><span class="o">.</span><span class="n">clang_lit_site_cfg</span> <span class="o">=</span> <span class="vm">__file__</span>
<span class="o">&gt;</span> <span class="n">config</span><span class="o">.</span><span class="n">clang_obj_root</span> <span class="o">=</span> <span class="n">path</span><span class="p">(</span><span class="n">install_dir</span><span class="p">)</span><span class="o">+</span><span class="n">path</span><span class="p">(</span><span class="sa">r</span><span class="s2">&quot;/tools/clang&quot;</span><span class="p">)</span>
<span class="o">&gt;</span> <span class="n">config</span><span class="o">.</span><span class="n">clang_src_dir</span> <span class="o">=</span> <span class="n">path</span><span class="p">(</span><span class="n">llvm_project_dir</span><span class="p">)</span><span class="o">+</span><span class="n">path</span><span class="p">(</span><span class="sa">r</span><span class="s2">&quot;/clang&quot;</span><span class="p">)</span>
<span class="o">&gt;</span> <span class="n">config</span><span class="o">.</span><span class="n">clang_tools_dir</span> <span class="o">=</span> <span class="n">path</span><span class="p">(</span><span class="n">install_dir</span><span class="p">)</span><span class="o">+</span><span class="n">path</span><span class="p">(</span><span class="sa">r</span><span class="s2">&quot;/./bin&quot;</span><span class="p">)</span>
<span class="o">&gt;</span> <span class="n">config</span><span class="o">.</span><span class="n">clang_lib_dir</span> <span class="o">=</span> <span class="n">path</span><span class="p">(</span><span class="n">install_dir</span><span class="p">)</span><span class="o">+</span><span class="n">path</span><span class="p">(</span><span class="sa">r</span><span class="s2">&quot;/lib&quot;</span><span class="p">)</span>
<span class="o">&gt;</span> <span class="n">config</span><span class="o">.</span><span class="n">host_triple</span> <span class="o">=</span> <span class="s2">&quot;x86_64-unknown-linux-gnu&quot;</span>
<span class="o">&gt;</span> <span class="n">config</span><span class="o">.</span><span class="n">target_triple</span> <span class="o">=</span> <span class="s2">&quot;riscv64-unknown-elf&quot;</span>
<span class="o">&gt;</span> <span class="n">config</span><span class="o">.</span><span class="n">host_cc</span> <span class="o">=</span> <span class="s2">&quot;/usr/bin/cc&quot;</span>
<span class="o">&gt;</span> <span class="n">config</span><span class="o">.</span><span class="n">host_cxx</span> <span class="o">=</span> <span class="s2">&quot;/usr/bin/c++&quot;</span>
<span class="mi">34</span><span class="n">c45</span>
<span class="o">&lt;</span> <span class="n">config</span><span class="o">.</span><span class="n">enable_experimental_new_pass_manager</span> <span class="o">=</span> <span class="mi">0</span>
<span class="o">---</span>
<span class="o">&gt;</span> <span class="n">config</span><span class="o">.</span><span class="n">enable_experimental_new_pass_manager</span> <span class="o">=</span> <span class="mi">1</span>
<span class="mi">36</span><span class="p">,</span><span class="mi">37</span><span class="n">c47</span><span class="p">,</span><span class="mi">48</span>
<span class="o">&lt;</span> <span class="n">config</span><span class="o">.</span><span class="n">host_arch</span> <span class="o">=</span> <span class="s2">&quot;arm64&quot;</span>
<span class="o">&lt;</span> <span class="n">config</span><span class="o">.</span><span class="n">python_executable</span> <span class="o">=</span> <span class="s2">&quot;/opt/homebrew/Frameworks/Python.framework/Versions/3.9/bin/python3.9&quot;</span>
<span class="o">---</span>
<span class="o">&gt;</span> <span class="n">config</span><span class="o">.</span><span class="n">host_arch</span> <span class="o">=</span> <span class="s2">&quot;x86_64&quot;</span>
<span class="o">&gt;</span> <span class="n">config</span><span class="o">.</span><span class="n">python_executable</span> <span class="o">=</span> <span class="s2">&quot;/usr/bin/python3.6&quot;</span>
<span class="mi">40</span><span class="n">a52</span>
<span class="o">&gt;</span> <span class="n">config</span><span class="o">.</span><span class="n">llvm_external_lit</span> <span class="o">=</span> <span class="n">path</span><span class="p">(</span><span class="sa">r</span><span class="s2">&quot;&quot;</span><span class="p">)</span>
<span class="n">diff</span> <span class="o">-</span><span class="n">r</span> <span class="n">origin</span><span class="o">/</span><span class="n">utils</span><span class="o">/</span><span class="n">lit</span><span class="o">/</span><span class="n">lit</span><span class="o">.</span><span class="n">site</span><span class="o">.</span><span class="n">cfg</span> <span class="n">modify</span><span class="o">/</span><span class="n">utils</span><span class="o">/</span><span class="n">lit</span><span class="o">/</span><span class="n">lit</span><span class="o">.</span><span class="n">site</span><span class="o">.</span><span class="n">cfg</span>
<span class="mi">3</span><span class="n">a4</span><span class="p">,</span><span class="mi">9</span>
<span class="o">&gt;</span> <span class="kn">import</span><span class="w"> </span><span class="nn">os</span>
<span class="o">&gt;</span> 
<span class="o">&gt;</span> <span class="n">llvm_project_dir</span> <span class="o">=</span> <span class="n">os</span><span class="o">.</span><span class="n">environ</span><span class="p">[</span><span class="s2">&quot;PHOENIX_LLVM_DIR&quot;</span><span class="p">]</span>
<span class="o">&gt;</span> <span class="nb">print</span><span class="p">(</span><span class="s1">&#39;llvm_project_dir: &#39;</span><span class="p">,</span> <span class="n">llvm_project_dir</span><span class="p">)</span>
<span class="o">&gt;</span> <span class="n">install_dir</span> <span class="o">=</span> <span class="n">os</span><span class="o">.</span><span class="n">environ</span><span class="p">[</span><span class="s2">&quot;LLVM_INSTALLED_DIR&quot;</span><span class="p">]</span>
<span class="o">&gt;</span> 
<span class="mi">4</span><span class="n">a11</span>
<span class="o">&gt;</span> <span class="kn">from</span><span class="w"> </span><span class="nn">pathlib</span><span class="w"> </span><span class="kn">import</span> <span class="n">Path</span>
<span class="mi">7</span><span class="n">c14</span>
<span class="o">&lt;</span>     <span class="k">return</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">dirname</span><span class="p">(</span><span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">abspath</span><span class="p">(</span><span class="vm">__file__</span><span class="p">)),</span> <span class="n">p</span><span class="p">)</span>
<span class="o">---</span>
<span class="o">&gt;</span>     <span class="k">return</span> <span class="nb">str</span><span class="p">((</span><span class="n">Path</span><span class="p">(</span><span class="vm">__file__</span><span class="p">)</span><span class="o">.</span><span class="n">parent</span> <span class="o">/</span> <span class="n">p</span><span class="p">)</span><span class="o">.</span><span class="n">resolve</span><span class="p">())</span>
<span class="mi">13</span><span class="p">,</span><span class="mi">15</span><span class="n">c20</span><span class="p">,</span><span class="mi">22</span>
<span class="o">&lt;</span> <span class="n">config</span><span class="o">.</span><span class="n">llvm_src_root</span> <span class="o">=</span> <span class="s2">&quot;/Users/cschen/llvm/test/llvm&quot;</span>
<span class="o">&lt;</span> <span class="n">config</span><span class="o">.</span><span class="n">llvm_obj_root</span> <span class="o">=</span> <span class="s2">&quot;/Users/cschen/llvm/test/build&quot;</span>
<span class="o">&lt;</span> <span class="n">config</span><span class="o">.</span><span class="n">llvm_tools_dir</span> <span class="o">=</span> <span class="s2">&quot;/Users/cschen/llvm/test/build/./bin&quot;</span>
<span class="o">---</span>
<span class="o">&gt;</span> <span class="n">config</span><span class="o">.</span><span class="n">llvm_src_root</span> <span class="o">=</span> <span class="n">path</span><span class="p">(</span><span class="n">llvm_project_dir</span><span class="p">)</span><span class="o">+</span><span class="n">path</span><span class="p">(</span><span class="sa">r</span><span class="s2">&quot;/llvm&quot;</span><span class="p">)</span>
<span class="o">&gt;</span> <span class="n">config</span><span class="o">.</span><span class="n">llvm_obj_root</span> <span class="o">=</span> <span class="n">path</span><span class="p">(</span><span class="n">install_dir</span><span class="p">)</span>
<span class="o">&gt;</span> <span class="n">config</span><span class="o">.</span><span class="n">llvm_tools_dir</span> <span class="o">=</span> <span class="n">path</span><span class="p">(</span><span class="n">install_dir</span><span class="p">)</span><span class="o">+</span><span class="n">path</span><span class="p">(</span><span class="sa">r</span><span class="s2">&quot;/./bin&quot;</span><span class="p">)</span>
<span class="mi">30</span><span class="n">c37</span>
<span class="o">&lt;</span> <span class="n">lit_config</span><span class="o">.</span><span class="n">load_config</span><span class="p">(</span><span class="n">config</span><span class="p">,</span> <span class="s2">&quot;/Users/cschen/llvm/test/build/utils/lit/tests/lit.cfg&quot;</span><span class="p">)</span>
<span class="o">---</span>
<span class="o">&gt;</span> <span class="n">lit_config</span><span class="o">.</span><span class="n">load_config</span><span class="p">(</span><span class="n">config</span><span class="p">,</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">config</span><span class="o">.</span><span class="n">llvm_obj_root</span><span class="p">,</span> <span class="s2">&quot;utils/lit/tests/lit.cfg&quot;</span><span class="p">))</span>
</pre></div>
</div>
<ul class="simple">
<li><p>Only <cite>tools/clang/test/lit.site.cfg.py</cite> and <cite>test/lit.site.cfg.py</cite> need to be
modified.</p></li>
<li><p>The other files, <cite>tools/clang/test/Unit/lit.site.cfg.py</cite>,
<cite>test/Unit/lit.site.cfg.py</cite>, and <cite>utils/lit/tests/lit.site.cfg.in</cite>, are empty
and not used. However, I modified them as well for completeness.</p></li>
</ul>
<aside class="footnote-list brackets">
<aside class="footnote brackets" id="sphinx-install" role="doc-footnote">
<span class="label"><span class="fn-bracket">[</span><a role="doc-backlink" href="#id5">1</a><span class="fn-bracket">]</span></span>
<p><a class="reference external" href="https://www.sphinx-doc.org/en/master/usage/installation.html">https://www.sphinx-doc.org/en/master/usage/installation.html</a></p>
</aside>
<aside class="footnote brackets" id="maxtex" role="doc-footnote">
<span class="label"><span class="fn-bracket">[</span><a role="doc-backlink" href="#id11">2</a><span class="fn-bracket">]</span></span>
<p><a class="reference external" href="http://www.tug.org/mactex/">http://www.tug.org/mactex/</a></p>
</aside>
<aside class="footnote brackets" id="latexmk" role="doc-footnote">
<span class="label"><span class="fn-bracket">[</span><a role="doc-backlink" href="#id12">3</a><span class="fn-bracket">]</span></span>
<p><a class="reference external" href="https://zoomadmin.com/HowToInstall/UbuntuPackage/latexmk">https://zoomadmin.com/HowToInstall/UbuntuPackage/latexmk</a></p>
</aside>
<aside class="footnote brackets" id="sphinx-math" role="doc-footnote">
<span class="label"><span class="fn-bracket">[</span><a role="doc-backlink" href="#id1">4</a><span class="fn-bracket">]</span></span>
<p><a class="reference external" href="https://sphinx-rtd-trial.readthedocs.io/en/latest/ext/math.html#module-sphinx.ext.mathbase">https://sphinx-rtd-trial.readthedocs.io/en/latest/ext/math.html#module-sphinx.ext.mathbase</a></p>
</aside>
<aside class="footnote brackets" id="mathbase-latex" role="doc-footnote">
<span class="label"><span class="fn-bracket">[</span><a role="doc-backlink" href="#id2">5</a><span class="fn-bracket">]</span></span>
<p><a class="reference external" href="https://mirrors.mit.edu/CTAN/info/short-math-guide/short-math-guide.pdf">https://mirrors.mit.edu/CTAN/info/short-math-guide/short-math-guide.pdf</a></p>
</aside>
<aside class="footnote brackets" id="gv-doc-pdf" role="doc-footnote">
<span class="label"><span class="fn-bracket">[</span><a role="doc-backlink" href="#id4">6</a><span class="fn-bracket">]</span></span>
<p><a class="reference external" href="https://www.graphviz.org/pdf/dotguide.pdf">https://www.graphviz.org/pdf/dotguide.pdf</a></p>
</aside>
<aside class="footnote brackets" id="graphviz-cluster" role="doc-footnote">
<span class="label"><span class="fn-bracket">[</span><a role="doc-backlink" href="#id3">7</a><span class="fn-bracket">]</span></span>
<p>Ex. lbd/Fig/gpu/opengl-flow.gv. If the name of the subgraph begins with cluster, Graphviz notes the subgraph as a special cluster subgraph. If supported, the layout engine will do the layout so that the nodes belonging to the cluster are drawn together, with the entire drawing of the cluster contained within a bounding rectangle. <a class="reference external" href="https://graphviz.org/doc/info/lang.html">https://graphviz.org/doc/info/lang.html</a>.</p>
</aside>
<aside class="footnote brackets" id="rst-ref" role="doc-footnote">
<span class="label"><span class="fn-bracket">[</span><a role="doc-backlink" href="#id6">8</a><span class="fn-bracket">]</span></span>
<p><a class="reference external" href="http://docutils.sourceforge.net/docs/ref/rst/restructuredtext.html">http://docutils.sourceforge.net/docs/ref/rst/restructuredtext.html</a></p>
</aside>
<aside class="footnote brackets" id="rst-dir" role="doc-footnote">
<span class="label"><span class="fn-bracket">[</span><a role="doc-backlink" href="#id7">9</a><span class="fn-bracket">]</span></span>
<p><a class="reference external" href="http://docutils.sourceforge.net/docs/ref/rst/directives.html">http://docutils.sourceforge.net/docs/ref/rst/directives.html</a></p>
</aside>
<aside class="footnote brackets" id="rst" role="doc-footnote">
<span class="label"><span class="fn-bracket">[</span><a role="doc-backlink" href="#id8">10</a><span class="fn-bracket">]</span></span>
<p><a class="reference external" href="http://docutils.sourceforge.net/rst.html">http://docutils.sourceforge.net/rst.html</a></p>
</aside>
<aside class="footnote brackets" id="llvm-sphinx-quick" role="doc-footnote">
<span class="label"><span class="fn-bracket">[</span><a role="doc-backlink" href="#id9">11</a><span class="fn-bracket">]</span></span>
<p><a class="reference external" href="http://llvm.org/docs/SphinxQuickstartTemplate.html">http://llvm.org/docs/SphinxQuickstartTemplate.html</a> If you need to show LLVM IR use the llvm code block. <a class="reference external" href="https://llvm.org/docs/SphinxQuickstartTemplate.html#code-blocks">https://llvm.org/docs/SphinxQuickstartTemplate.html#code-blocks</a></p>
</aside>
<aside class="footnote brackets" id="sphinx-lexers" role="doc-footnote">
<span class="label"><span class="fn-bracket">[</span><a role="doc-backlink" href="#id10">12</a><span class="fn-bracket">]</span></span>
<p><a class="reference external" href="http://pygments.org/docs/lexers/">http://pygments.org/docs/lexers/</a></p>
</aside>
<aside class="footnote brackets" id="test" role="doc-footnote">
<span class="label"><span class="fn-bracket">[</span><a role="doc-backlink" href="#id13">13</a><span class="fn-bracket">]</span></span>
<p><a class="reference external" href="http://llvm.org/docs/TestingGuide.html">http://llvm.org/docs/TestingGuide.html</a></p>
</aside>
</aside>
</section>
</section>


      </div>
      <div class="bottomnav" role="navigation" aria-label="Bottom">
      
        <p>
        «&#160;&#160;<a href="install.html">Appendix A: Getting Started: Installing LLVM and the Cpu0 Example Code</a>
        &#160;&#160;::&#160;&#160;
        <a class="uplink" href="index.html">Contents</a>
        &#160;&#160;::&#160;&#160;
        <a href="npu.html">Appendix C: The concept of NPU (Neural Processor Unit) compiler</a>&#160;&#160;»
        </p>

      </div>

    <div class="footer" role="contentinfo">
    &#169; Copyright 2016, Chen Chung-Shu.
      Created using <a href="https://www.sphinx-doc.org/">Sphinx</a> 9.1.0.
    </div>
  </body>
</html>